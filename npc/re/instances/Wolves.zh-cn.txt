//===== rAthena Script =======================================
//= Instances: Wolves Gathering Place and Sanctuary Purification.
//===== Description: =========================================
//- [Walkthrough conversion]
//- "Wolves Gathering Place" is a part of the Episode 18 main quest.
//- Sanctuary Purification is a daily quest.
//===== Changelogs: ==========================================
//= 1.0 First version. [Capuche]
//============================================================

// Main Quest: Step 54. (entrance npc is a part of the instance Wolves Gathering Place)
rachel,167,244,5	duplicate(dummy_cloaked_npc)	Suad#sms03	4_EP18_SUAD
rachel,167,242,7	duplicate(dummy_cloaked_npc)	Miriam#sms03	4_EP18_MIRIAM

rachel,169,245,3	script	Ordinary Person#sms04	4_EP18_GW_WOMAN01,{
	if (BaseLevel < 170) {
		mes "[狼]";
		mes "你是来参加抗议活动的吗？但你看起来不像是一个经验丰富的抗议者。";
		next;
		mes "- 这个任务从 170 级开始可以进行。 -";
		close;
	}
	if (ep18_main < 50) {
		mes "[普通人]";
		mes "该区域正在维护中，禁止进入。这很危险。请退后一步。";
		close;
	}
	if (ep18_main == 50 || ep18_main == 51) {
		if (ep18_main == 50) {
			mes "[普通人]";
			mes "该区域正在维护中，禁止进入。";
			next;
			cutin "ep18_suad_01.png",2;
			cloakoffnpcself( "Suad#sms03" );
			mes "[苏阿德]";
			mes "你不需要那么谨慎。这个人是和我们一起的冒险者。";
			next;
			cutin "ep18_miriam_01.png",0;
			cloakoffnpcself( "Miriam#sms03" );
			mes "[米丽亚姆]";
			mes "我们现在都聚集了吗？";
			next;
			cutin "ep18_suad_01.png",2;
			mes "[苏阿德]";
			mes "是的，大家都准备好了。我们只需要向分散在各处的人发出信号，然后进入圣殿即可。";
			next;
			cutin "ep18_miriam_01.png",0;
			mes "[米丽亚姆]";
			mes "我们需要迅速行动。";
			next;
		}
		cutin "ep18_suad_01.png",2;
		mes "[苏阿德]";
		mes "进入这里后，我们可以朝寺庙的侧门走去。向那边发送信号后收到响应后我们就会进入。冒险，你能发出信号吗？";
		next;

		.@md_name$ = "Wolves Gathering Place";

		if (is_party_leader()) {
			.@menu$[0] = "Yes, go ahead and send the signal.";
			.@menu$[1] = "Let's enter quickly.";
		}

		switch( select( .@menu$[0], .@menu$[1], "我们需要做好准备。" ) ) {
		case 1:
			mes "嘟-";
			next;
			instance_create(.@md_name$);
			mes "[苏阿德]";
			mes "既然我们发出了信号，紧急通道很快就会打开。当您准备好时请告诉我们。我们马上进去。";
			if (ep18_main == 50) {
				changequest 17519,17520;
				ep18_main = 51;
			}
			close3;
		case 2:
			switch( instance_enter(.@md_name$) ) {
			case IE_OTHER:
				mes "[苏阿德]";
				mes "^ff0000发生未知错误。^000000";
				close3;
			case IE_NOINSTANCE:
				mes "[苏阿德]";
				mes "我们还没有发出信号。一旦所有人准备就绪，我们就会立即发出信号。";
				close3;
			case IE_NOMEMBER:
				mes "[苏阿德]";
				mes "^ff0000只有队伍成员才能进入纪念地下城。^000000";
				close3;
			case IE_OK:
				mes "[苏阿德]";
				mes "信号来了，我们行动吧。我们马上进入吧。";
				if (ep18_main == 50) {	// debug
					changequest 17519,17520;
					ep18_main = 51;
				}
				cutin "",255;
				mapannounce "rachel", "Adventurer " + strcharinfo(0) + " of the " + getpartyname( getcharid(1) ) + " party will enter " + .@md_name$ + " first. All wolves, gather sequentially.", bc_map, 0xFF99;
				// warp "1@nyr",194,30;
				close;
			}
			end;
		case 3:
			mes "[苏阿德]";
			mes "正确的。冒险者也是必不可少的力量，所以就等他们准备好了再说吧。";
			close3;
		}
		end;
	}
	mes "[普通人]";
	mes "你好，冒险家。寺庙的特工已经在等你了。";
	close2;
	cloakoffnpcself( "Priest#sms01" );
	npctalk "冒险家，欢迎。", "牧师#sms01", bc_self;
	end;

OnInit:
	questinfo( QTYPE_QUEST2, QMARK_YELLOW, "isbegin_quest(17519) == 1" );

	// Sanctuary Purification
	questinfo( QTYPE_DAILYQUEST, QMARK_YELLOW, "checkquest(17527,PLAYTIME) == 2" );
	questinfo( QTYPE_DAILYQUEST, QMARK_YELLOW, "ep18_main >= 52 && checkquest(17527,PLAYTIME) == -1 && isbegin_quest(17522) == 0 && isbegin_quest(17523) == 0" );
	end;
}

// Instance Sanctuary Purification entrance
rachel,167,244,5	script(CLOAKED)	Priest#sms01	4_F_TRAINEE,{
	if (checkweight(1000405,4) == 0) {
		mes "- 等一下 ！！ -";
		mes "- 目前你携带的是 -";
		mes "- 你身上带的东西太多了。 -";
		mes "- 请再试一次 -";
		mes "- 减肥后。 -";
		close;
	}
	if (ep18_main < 52)
		end;
	// repeatable instance Sanctuary Purification
	if (BaseLevel < 170) {
		mes "[牧师]";
		mes "对于此实例，您的基础等级必须至少为 170。";
		close;
	}
	if (isbegin_quest(17524) == 1 || isbegin_quest(17526) == 1) {
		mes "[牧师]";
		mes "欢迎，冒险家。你经历了很多。";
		if (isbegin_quest(17524) == 1) {
			erasequest 17524;
			.@count = 2;
		}
		if (isbegin_quest(17526) == 1) {
			erasequest 17526;
			.@count += 2;
		}
		getitem 1000405,.@count;	// Ep18_Amethyst_Fragment
		next;
		mes "[牧师]";
		mes "现在请您在旅途中休息一下！再见！";
		close;
	}
	.@md_name$ = "Sanctuary Purification";

	switch( checkquest(17527,PLAYTIME) ) {
	case -1:
		if (isbegin_quest(17522) == 0 && isbegin_quest(17523) == 0)
			callsub( S_Take, 0, "Since we're doing it, let's do both.", "Raid on the defected temple guards.", "Raid on the Heart Hunters.", "", "It's going to be tough." );
		break;
	case 0:
	case 1:
		mes "[牧师]";
		mes "下一步行动的计划尚未完成。由于每天只进行一次，因此我们需要谨慎。在那之前请好好休息吧，冒险者。";
		close;
	case 2:
		mes "[牧师]";
		mes "你好！你休息好了吗？如果您今天能帮助我，我将不胜感激。请注意，该手术可以每天进行一次。";
		erasequest 17527;
		if (isbegin_quest(17522) == 0 && isbegin_quest(17523) == 0)
			callsub( S_Take, 2, "Since we're doing it, let's do both.", "Raid on the defected temple guards.", "Raid on the Heart Hunters.", "", "It's going to be tough." );
		break;
	}
	mes "[牧师]";
	mes "你准备好了吗？我将发送加入信号。";
	next;
	switch( select( "好吧。我会发出信号。", "我会继续。", "我还有任务待处理！", "需要更多准备。" ) ) {
	case 1:
		mes "[牧师]";
		mes "我已经收到集合点了您可以通过这个紧急出口立即加入。准备好后，继续进入。";
		if (instance_create(.@md_name$) < 0) {
			mes "派对：" + getpartyname(getcharid(1)) + "";
			mes "领导者：" + strcharinfo(0) + "";
			mes "^0000ff" + .@md_name$ + " ^000000- 未知错误";
			close;
		}
		end;
	case 2:
		switch( instance_enter(.@md_name$) ) {
		case IE_OTHER:
			mes "^ff0000发生未知错误。^000000";
			close;
		case IE_NOINSTANCE:
			mes "纪念地牢并不存在。";
			mes "党魁尚未生成地牢。";
			close;
		case IE_NOMEMBER:
			mes "^ff0000只有队伍成员才能进入纪念地下城。^000000";
			close;
		case IE_OK:
			mes "[牧师]";
			mes "信号已经到来，我们出发吧。我们马上进入集合点吧。";
			mapannounce "rachel", "" + strcharinfo(0) + " of the party, " + getpartyname( getcharid(1) ) + ", is entering " + .@md_name$ + ".",bc_map,"0x00ff99",FW_NORMAL,12;
			setquest 17527;
			// warp "1@nyr",194,30;
			end;
		}
		end;
	case 3:
		callsub( S_Take, 1, "", "Raid on the defected temple guards.", "Raid on the Heart Hunters.", "Since we're doing it, let's do both.", "It's going to be tough." );
	case 4:
		mes "[牧师]";
		mes "明白了。我会等待。";
		close;
	}
	end;

S_Take:
	if (getarg(0) == 0) {
		mes "[牧师]";
		mes "潜入圣殿的主力已经逃走，但我们仍然面临着投奔猎心者的圣殿守卫和追寻心脏的猎心者残余的麻烦。";
		next;
		mes "[牧师]";
		mes "我们正在独立进行突袭，但我们非常感谢你的帮助，冒险家。请注意，突击检查每天进行一次。";
	}
	else if (getarg(0) == 1) {
		mes "[牧师]";
		mes "是这样吗？你错过了什么任务？";
	}
	next;
	switch( select( getarg(1), getarg(2), getarg(3), getarg(4), getarg(5) ) ) {
	case 1:
	case 4:	// (same menu as 1 but order is different)
		if (isbegin_quest(17522) == 0 && isbegin_quest(17524) == 0)
			setquest 17522;
		if (isbegin_quest(17523) == 0 && isbegin_quest(17526) == 0)
			setquest 17523;
		mes "[牧师]";
		mes "明白了。";
		next;
		mes "[牧师]";
		mes "那么请在您准备好后告诉我。";
		close;
	case 2:
		if (isbegin_quest(17522) == 0 && isbegin_quest(17524) == 0) {
			setquest 17522;
			mes "[牧师]";
			mes "突袭叛逃的圣殿守卫，是这样吗？明白了。";
			next;
			mes "[牧师]";
			mes "那么请在您准备好后告诉我。";
			close;
		}
		mes "[牧师]";
		mes "看来你已经在执行任务了。很好，请多多关照。";
		next;
		mes "[牧师]";
		mes "那么请在您准备好后告诉我。";
		close;
	case 3:
		if (isbegin_quest(17523) == 0 && isbegin_quest(17526) == 0) {
			setquest 17523;
			mes "[牧师]";
			mes "感谢您的合作。当你准备好时请告诉我。";
			close;
		}
		mes "[牧师]";
		mes "看来你已经在执行任务了。很好，请多多关照。";
		next;
		mes "[牧师]";
		mes "那么请在您准备好后告诉我。";
		close;
	case 5:
		mes "[牧师]";
		mes "如果真是这样的话，那我们也没什么办法了。下次再见！";
		close2;
		cloakonnpcself( "Priest#sms01" );
		end;
	}
	end;
}


// Define the instance variables and disable the unused NPCs
1@nyr,1,1,0	script	nyr_starter	-1,{
	end;
OnInstanceInit:
	'nyr_main_step = 0;
	'nyr_daily_step = 0;
	'code = 0;
	'map_1nyr$ = instance_mapname("1@nyr");
	'map_2nyr$ = instance_mapname("2@nyr");

	if (instance_live_info(ILI_NAME) == "Wolves Gathering Place") {	// Wolves Gathering Place instance : disable the stater NPCs of Sanctuary Purification
		disablenpc instance_npcname("#qar101sw");

		for ( .@i = 1; .@i < 16; ++.@i ) {
			if (.@i < 10)
				.@string$ = "0" + .@i;
			else
				.@string$ = "" + .@i;
			disablenpc instance_npcname("#cell" + .@string$);
		}
		disablenpc instance_npcname("#cell42");
		disablenpc instance_npcname("#cell51");
		disablenpc instance_npcname("#cell66");
		
		// disablenpc instance_npcname("#cell41");	// duplicate of 8
		disablenpc instance_npcname("#qmobg101");
	}
	else {	// Sanctuary Purification instance : disable the stater NPCs of Wolves Gathering Place
		// Step 1 - Wolves Gathering Place
		disablenpc instance_npcname("Miriam#dms101");
		disablenpc instance_npcname("Suad#dms101");
		disablenpc instance_npcname("Lamacus#dms102");
		disablenpc instance_npcname("Kun#dms112");
		disablenpc instance_npcname("Yopi#dms122");
		disablenpc instance_npcname("Angry Crowd#dms171");
		disablenpc instance_npcname("Temple Guard#dms101");
		disablenpc instance_npcname("Temple Guard#dms111");
		disablenpc instance_npcname("Temple Guard#dms121");
		disablenpc instance_npcname("Temple Guard#dms131");
		disablenpc instance_npcname("Temple Guard#dms141");
		disablenpc instance_npcname("Temple Guard#dms151");
		disablenpc instance_npcname("Temple Guard#dms181");
		disablenpc instance_npcname("Temple Guard#dms191");
		disablenpc instance_npcname("Angry Crowd#dms101");
		disablenpc instance_npcname("Angry Crowd#dms111");
		disablenpc instance_npcname("Angry Crowd#dms121");
		disablenpc instance_npcname("Angry Crowd#dms131");
		disablenpc instance_npcname("Angry Crowd#dms141");
		disablenpc instance_npcname("Angry Crowd#dms151");
		disablenpc instance_npcname("Angry Crowd#dms161");
		disablenpc instance_npcname("Angry Crowd#dms181");
		disablenpc instance_npcname("Angry Crowd#dms191");
		
		// walls
		setcell 'map_1nyr$,89,24,89,153,cell_walkable,0;
		setcell 'map_1nyr$,150,24,150,153,cell_walkable,0;
	}

	// Sanctuary Purification instance - 1@nyr
	disablenpc instance_npcname("Temple Guard#qdms01");
	disablenpc instance_npcname("Temple Guard#qdms02");
	disablenpc instance_npcname("Temple Guard#qdms03");
	disablenpc instance_npcname("Temple Guard#qdms21");
	disablenpc instance_npcname("Temple Guard#qdms22");
	disablenpc instance_npcname("Temple Guard#qdms23");
	disablenpc instance_npcname("Temple Guard#qdms31");
	disablenpc instance_npcname("Temple Guard#qdms32");
	disablenpc instance_npcname("Temple Guard#qdms33");
	disablenpc instance_npcname("Temple Guard#qdms41");
	disablenpc instance_npcname("Temple Guard#qdms42");

	// disablenpc instance_npcname("#qmobg401");
	// disablenpc instance_npcname("#qar201sw");

	// warps
	disablenpc instance_npcname("#qwpto01");
	disablenpc instance_npcname("#qwpto02");
	disablenpc instance_npcname("#qwpto03");
	disablenpc instance_npcname("#areaw03");

	// disablenpc instance_npcname("#qwptora");	// unknown

	disablenpc instance_npcname("Temple Guard#qdms101");
	disablenpc instance_npcname("Temple Guard#qdms111");
	disablenpc instance_npcname("Temple Guard#qdms121");
	disablenpc instance_npcname("Temple Guard#qdms131");
	disablenpc instance_npcname("Temple Guard#qdms141");
	disablenpc instance_npcname("Temple Guard#qdms151");
	disablenpc instance_npcname("Temple Guard#qdms161");
	disablenpc instance_npcname("Temple Guard#qdms171");
	disablenpc instance_npcname("Temple Guard#qdms181");
	disablenpc instance_npcname("Temple Guard#qdms102");
	disablenpc instance_npcname("Temple Guard#qdms112");
	disablenpc instance_npcname("Temple Guard#qdms122");
	disablenpc instance_npcname("Temple Guard#qdms132");
	disablenpc instance_npcname("Temple Guard#qdms142");
	disablenpc instance_npcname("Temple Guard#qdms152");
	disablenpc instance_npcname("Temple Guard#qdms162");
	disablenpc instance_npcname("Temple Guard#qdms172");
	disablenpc instance_npcname("Temple Guard#qdms182");

	// Step 2 - Wolves Gathering Place
	disablenpc instance_npcname("Miriam#dms201");
	disablenpc instance_npcname("Temple Guard#dms201");
	disablenpc instance_npcname("Temple Guard#dms211");
	disablenpc instance_npcname("Temple Guard#dms221");
	disablenpc instance_npcname("Temple Guard#dms231");
	disablenpc instance_npcname("Temple Guard#dms241");
	disablenpc instance_npcname("#msna01");

	// Step 3 - Wolves Gathering Place
	disablenpc instance_npcname("Miriam#dms301");
	disablenpc instance_npcname("Lamacus#dms201");
	disablenpc instance_npcname("Yopi#dms221");
	disablenpc instance_npcname("Kun#dms211");
	disablenpc instance_npcname("Temple Guard#dms301");
	disablenpc instance_npcname("Temple Guard#dms311");
	disablenpc instance_npcname("Temple Guard#dms321");
	disablenpc instance_npcname("Temple Guard#dms331");
	disablenpc instance_npcname("Temple Guard#dms341");

	// Step 4 - Wolves Gathering Place
	disablenpc instance_npcname("Miriam#dms401");
	disablenpc instance_npcname("Lamacus#dms301");
	disablenpc instance_npcname("Kun#dms311");
	disablenpc instance_npcname("Yopi#dms321");
	disablenpc instance_npcname("Temple Guard#dms401");
	disablenpc instance_npcname("Temple Guard#dms411");
	disablenpc instance_npcname("Temple Guard#dms421");
	disablenpc instance_npcname("Temple Guard#dms431");
	disablenpc instance_npcname("Temple Guard#dms441");

	// Step 5 - Wolves Gathering Place
	disablenpc instance_npcname("Miriam#dms501");
	disablenpc instance_npcname("Lamacus#dms401");
	disablenpc instance_npcname("Kun#dms411");
	disablenpc instance_npcname("Yopi#dms421");
	disablenpc instance_npcname("Schulang#dms101");
	disablenpc instance_npcname("Temple Guard#dms501");
	disablenpc instance_npcname("Temple Guard#dms511");
	disablenpc instance_npcname("Temple Guard#dms521");
	disablenpc instance_npcname("Temple Guard#dms531");
	disablenpc instance_npcname("Temple Guard#dms541");

	// Step 6 - Wolves Gathering Place
	// disablenpc instance_npcname("#dmss101");
	disablenpc instance_npcname("Miriam#dms601");
	disablenpc instance_npcname("Lamacus#dms501");
	disablenpc instance_npcname("Kun#dms511");
	disablenpc instance_npcname("Yopi#dms521");
	disablenpc instance_npcname("Schulang#dms201");
	disablenpc instance_npcname("Bagot#dms101");
	disablenpc instance_npcname("Private Officer#dms101");
	disablenpc instance_npcname("Temple Guard#dms601");
	disablenpc instance_npcname("Temple Guard#dms611");
	disablenpc instance_npcname("Temple Guard#dms621");
	disablenpc instance_npcname("#effc01");

	// Step 7 + 8 - Wolves Gathering Place
	// disablenpc instance_npcname("#dms701");
	disablenpc instance_npcname("Miriam#dms701");
	disablenpc instance_npcname("Lamacus#dms601");
	disablenpc instance_npcname("Kun#dms611");
	disablenpc instance_npcname("Yopi#dms621");
	disablenpc instance_npcname("Niren#dms101");
	disablenpc instance_npcname("High Priest#dms201");
	disablenpc instance_npcname("Bagot#dms201");
	disablenpc instance_npcname("Schulang#dms301");
	disablenpc instance_npcname("Temple Guard#dms701");
	disablenpc instance_npcname("Temple Guard#dms711");
	disablenpc instance_npcname("Temple Guard#dms721");
	disablenpc instance_npcname("Temple Guard#dms731");
	disablenpc instance_npcname("Temple Guard#dms741");
	disablenpc instance_npcname("Temple Guard#dms751");
	disablenpc instance_npcname("Temple Guard#dms761");
	disablenpc instance_npcname("Temple Guard#dms771");

	// Step 9 - Wolves Gathering Place
	disablenpc instance_npcname("#dmswch02");
	disablenpc instance_npcname("Miriam#dms801");

	// Step 10 - Wolves Gathering Place
	disablenpc instance_npcname("Suad#dms102");

	disablenpc instance_npcname("Zhed#dms101");
	disablenpc instance_npcname("Niren#dms201");

	disablenpc instance_npcname("Temple Guard#dms802");
	disablenpc instance_npcname("Temple Guard#dms812");
	disablenpc instance_npcname("Temple Guard#dms822");
	disablenpc instance_npcname("Temple Guard#dms832");
	disablenpc instance_npcname("Temple Guard#dms842");

	disablenpc instance_npcname("Temple Guard#dms801");
	disablenpc instance_npcname("Temple Guard#dms811");
	disablenpc instance_npcname("Temple Guard#dms821");
	disablenpc instance_npcname("Temple Guard#dms831");
	disablenpc instance_npcname("Temple Guard#dms841");
	disablenpc instance_npcname("Temple Guard#dms851");
	disablenpc instance_npcname("Temple Guard#dms861");
	disablenpc instance_npcname("Temple Guard#dms871");
	disablenpc instance_npcname("Temple Guard#dms881");
	disablenpc instance_npcname("Temple Guard#dms891");

	disablenpc instance_npcname("Heart Hunter#dms101");
	disablenpc instance_npcname("Heart Hunter#dms111");
	disablenpc instance_npcname("Heart Hunter#dms121");
	disablenpc instance_npcname("Heart Hunter#dms131");
	disablenpc instance_npcname("Heart Hunter#dms141");
	disablenpc instance_npcname("Heart Hunter#dms151");
	disablenpc instance_npcname("Heart Hunter#dms161");
	disablenpc instance_npcname("Heart Hunter#dms171");
	disablenpc instance_npcname("Heart Hunter#dms181");
	disablenpc instance_npcname("Heart Hunter#dms191");

	disablenpc instance_npcname("Angry Crowd#dms201");
	disablenpc instance_npcname("Angry Crowd#dms211");
	disablenpc instance_npcname("Angry Crowd#dms221");
	disablenpc instance_npcname("Angry Crowd#dms231");
	disablenpc instance_npcname("Angry Crowd#dms241");
	disablenpc instance_npcname("Angry Crowd#dms251");
	disablenpc instance_npcname("Angry Crowd#dms261");
	disablenpc instance_npcname("Angry Crowd#dms271");
	disablenpc instance_npcname("Angry Crowd#dms281");
	disablenpc instance_npcname("Angry Crowd#dms291");

	disablenpc instance_npcname("Angry Crowd#dms202");
	disablenpc instance_npcname("Angry Crowd#dms212");
	disablenpc instance_npcname("Angry Crowd#dms222");
	disablenpc instance_npcname("Angry Crowd#dms232");
	disablenpc instance_npcname("Angry Crowd#dms242");

	// daily (2@nyr)
	disablenpc instance_npcname("Temple Guard#2dms221");
	disablenpc instance_npcname("Temple Guard#2dms231");
	disablenpc instance_npcname("Temple Guard#2dms241");
	disablenpc instance_npcname("#2mstep11");
	disablenpc instance_npcname("Temple Guard#2dms201");
	disablenpc instance_npcname("Temple Guard#2dms251");
	disablenpc instance_npcname("Temple Guard#2dms211");

	disablenpc instance_npcname("#2ar101sw");
	disablenpc instance_npcname("Temple Guard#2dms101");
	disablenpc instance_npcname("Temple Guard#2dms111");
	disablenpc instance_npcname("Temple Guard#2dms121");
	disablenpc instance_npcname("Temple Guard#2dms131");
	disablenpc instance_npcname("Temple Guard#2dms141");
	disablenpc instance_npcname("Temple Guard#2dms151");
	disablenpc instance_npcname("Temple Guard#2dms161");
	disablenpc instance_npcname("#2mstep01");
	disablenpc instance_npcname("#2mstep02");
	disablenpc instance_npcname("Security Device#2dms10");
	disablenpc instance_npcname("#2mstep03");
	disablenpc instance_npcname("#2mstep04");
	disablenpc instance_npcname("Security Device#2dms20");
	disablenpc instance_npcname("#2mstep05");
	disablenpc instance_npcname("#2mstep06");
	disablenpc instance_npcname("Security Device#2dms30");
	disablenpc instance_npcname("#2mstep07");
	disablenpc instance_npcname("#2mstep08");
	disablenpc instance_npcname("#2mstep09");
	disablenpc instance_npcname("Security Device#2dms40");
	disablenpc instance_npcname("#2mstep10");
	disablenpc instance_npcname("#msnavi01");
	disablenpc instance_npcname("Temple Guard#2dms261");

	disablenpc instance_npcname("#2ar201sw");
	disablenpc instance_npcname("Heart Hunter#2dms50");

	disablenpc instance_npcname("Temple Guard#2dms10");
	disablenpc instance_npcname("Heart Hunter#2dms11");
	disablenpc instance_npcname("Heart Hunter#2dms12");
	disablenpc instance_npcname("Heart Hunter#2dms13");

	disablenpc instance_npcname("Heart Hunter#2dms20");
	disablenpc instance_npcname("Heart Hunter#2dms21");
	disablenpc instance_npcname("Heart Hunter#2dms22");

	disablenpc instance_npcname("Heart Hunter#2dms30");
	disablenpc instance_npcname("Heart Hunter#2dms31");
	disablenpc instance_npcname("Heart Hunter#2dms32");

	disablenpc instance_npcname("Heart Hunter#2dms40");
	disablenpc instance_npcname("Heart Hunter#2dms41");
	disablenpc instance_npcname("Heart Hunter#2dms42");
	disablenpc instance_npcname("Heart Hunter#2dms43");
	disablenpc instance_npcname("Heart Hunter#2dms44");
	disablenpc instance_npcname("Heart Hunter#2dms45");
	disablenpc instance_npcname("Heart Hunter#2dms46");
	disablenpc instance_npcname("Heart Hunter#2dms47");
	disablenpc instance_npcname("Heart Hunter#2dms48");
	disablenpc instance_npcname("Heart Hunter#2dms49");

	// warps
	disablenpc instance_npcname("#dmswp01");
	disablenpc instance_npcname("#dmwrp02");

	disablenpc instance_npcname("#mstep01");
	disablenpc instance_npcname("#mstep02");
	disablenpc instance_npcname("#mstep03");
	disablenpc instance_npcname("#mstep04");
	disablenpc instance_npcname("#mstep05");
	disablenpc instance_npcname("#mstep06");
	disablenpc instance_npcname("#mstep07");
	disablenpc instance_npcname("#mstep08");
	disablenpc instance_npcname("#mstep09");
	disablenpc instance_npcname("#mstep10");
	disablenpc instance_npcname("#mstep11");
	end;
}

//------------------------------------------------------------
// Warp NPCs
//------------------------------------------------------------
1@nyr,179,168,0	warp	#dmswp01	1,1,2@nyr,34,221

1@nyr,43,26,0	script	#dmwrp02	WARPNPC,1,1,{
	end;
OnTouch_:
	warp "rachel",117,197;
	if ('nyr_main_step == 22) {
		if (ep18_main == 51) {
			changequest 17520,17521;
			ep18_main = 52;
		}
	}
	end;
}

2@nyr,56,104,0	warp	#mstep01	1,1,2@nyr,49,104

2@nyr,49,55,0	script	#mstep02	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,53,55;
	if ('nyr_main_step == 8)
		navigateto("2@nyr",119,73);
	end;
}

2@nyr,119,73,0	warp	#mstep03	1,1,2@nyr,119,65

2@nyr,119,67,0	script	#mstep04	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,119,75;
	if ('nyr_main_step == 10)
		navigateto("2@nyr",183,104);
	end;
}

2@nyr,183,104,0	warp	#mstep05	1,1,2@nyr,190,104

2@nyr,186,104,0	script	#mstep06	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,180,104;
	if ('nyr_main_step == 12)
		navigateto("2@nyr",133,109);
	end;
}

2@nyr,120,123,0	warp	#mstep07	1,1,2@nyr,120,126

2@nyr,120,137,0	script	#mstep08	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,120,147;
	if ('nyr_main_step == 13)
		navigateto("2@nyr",118,199);
	end;
}

2@nyr,120,141,0	script	#mstep09	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,120,134;
	if ('nyr_main_step == 16)
		navigateto("2@nyr",151,131);
	end;
}

2@nyr,151,131,0	script	#mstep10	WARPNPC,1,1,{
	end;
OnTouch_:
	warp 'map_2nyr$,159,131;
	if ('nyr_main_step == 16)
		navigateto("2@nyr",203,220);
	end;
}

2@nyr,203,220,0	warp	#mstep11	1,1,1@nyr,65,169


//------------------------------------------------------------
// Step 1
//------------------------------------------------------------
1@nyr,192,31,3	script	Miriam#dms101	EP18_NPC_MIRIAM,5,5,{
	end;
OnTouch:
	if ('nyr_main_step == 1) {
		navigateto("1@nyr",125,41);
		end;
	}
	if ('nyr_main_step != 0)
		end;

	'nyr_main_step = 1;
	setpcblock PCBLOCK_NPC, true;
	npctalk "冒险家！";
	emotion ET_SURPRISE;
	sleep2 1000;
	navigateto("1@nyr",125,41);
	setpcblock PCBLOCK_NPC, false;
	npctalk "前方是集结点。";
	unitwalk getnpcid(0), 162,31, instance_npcname("Miriam#dms101") + "::OnMove1";
	sleep 2000;
	npctalk "请这边走。";
	end;

OnMove1:
	unitwalk getnpcid(0), 137,31, instance_npcname("Miriam#dms101") + "::OnMove2";
	end;
OnMove2:
	unitwalk getnpcid(0), 128,41, instance_npcname("Miriam#dms101") + "::OnMove3";
	npctalk "它就在我面前。";
	end;
OnMove3:
	if ('nyr_main_step != 1)
		end;
	'nyr_main_step = 2;

	npctalk "苏阿德，什么情况？", instance_npcname("米里亚姆#dms101");
	npctalk "不允许再进入！", instance_npcname("圣殿守卫#dms101");
	sleep 1000;
	npctalk "米丽亚姆，冒险家。这里再远一点。", instance_npcname("苏阿德#dms101");
	sleep 1000;
	npctalk "这太过分了！他们对待我们就像对待罪犯一样！", instance_npcname("什么时候#dms112");
	npctalk "我们是不是到了不该到的地方了？", instance_npcname("愤怒的人群#dms131");
	sleep 1500;
	npctalk "嘿，那个地方是我曾曾祖母的土地！", instance_npcname("愤怒的人群#dms121");
	npctalk "我们完全有权利来到这里！", instance_npcname("愤怒的人群#dms161");
	sleep 2000;
	npctalk "是的！！别挡我们的路！", instance_npcname("愤怒的人群#dms191");
	npctalk "你把我们推开了！", instance_npcname("愤怒的人群#dms181");
	sleep 2000;
	npctalk "是因为我们看起来不像人类吗？", instance_npcname("愤怒的人群#dms101");
	npctalk "是因为我们看起来很轻松吗？", instance_npcname("愤怒的人群#dms131");
	sleep 2000;
	npctalk "我们正在争取我们应有的地位！", instance_npcname("愤怒的人群#dms121");
	npctalk "我勒个去！！把我们的土地还给我们！！", instance_npcname("愤怒的人群#dms181");
	sleep 2000;
	npctalk "我们是这片土地的长期所有者，但已被定居者流离失所。", instance_npcname("愤怒的人群#dms101");
	npctalk "谁在拖我们的后腿？！", instance_npcname("愤怒的人群#dms141");
	sleep 2000;
	npctalk "作为这片土地上的长期居民，我们来到这里，要求拥有应有的地位。", instance_npcname("愤怒的人群#dms101");
	npctalk "那些非法侵占我们土地的人就该离开！", instance_npcname("愤怒的人群#dms191");
	sleep 2000;
	npctalk "禁止非法抗议！赶紧解散吧！", instance_npcname("圣殿守卫#dms101");
	npctalk "谁说我们的抗议是非法的？", instance_npcname("愤怒的人群#dms151");
	npctalk "你只是说这是违法的吗？", instance_npcname("愤怒的人群#dms171");
	sleep 2000;
	npctalk "我们的要求如下！", instance_npcname("愤怒的人群#dms101");
	sleep 2000;
	npctalk "一！我们是这片土地的主人！那些非法占用的人必须离开！", instance_npcname("愤怒的人群#dms101");
	npctalk "退后！", instance_npcname("愤怒的人群#dms111");
	npctalk "退后！", instance_npcname("愤怒的人群#dms121");
	npctalk "退后！", instance_npcname("愤怒的人群#dms131");
	npctalk "退后！", instance_npcname("愤怒的人群#dms141");
	npctalk "退后！", instance_npcname("愤怒的人群#dms151");
	npctalk "退后！", instance_npcname("愤怒的人群#dms161");
	npctalk "退后！", instance_npcname("愤怒的人群#dms171");
	npctalk "退后！", instance_npcname("愤怒的人群#dms181");
	npctalk "退后！", instance_npcname("愤怒的人群#dms191");
	sleep 2000;
	npctalk "二！废除不公平的歧视政策，承认我们的权利！", instance_npcname("愤怒的人群#dms101");
	npctalk "承认吧！", instance_npcname("愤怒的人群#dms111");
	npctalk "承认吧！", instance_npcname("愤怒的人群#dms121");
	npctalk "承认吧！", instance_npcname("愤怒的人群#dms131");
	npctalk "承认吧！", instance_npcname("愤怒的人群#dms141");
	npctalk "承认吧！", instance_npcname("愤怒的人群#dms151");
	npctalk "承认吧！", instance_npcname("愤怒的人群#dms161");
	npctalk "承认吧！", instance_npcname("愤怒的人群#dms171");
	npctalk "承认吧！", instance_npcname("愤怒的人群#dms181");
	npctalk "承认吧！", instance_npcname("愤怒的人群#dms191");
	end;

OnStartMove2:
	npcspeed 100;
	unitwalk getnpcid(0), 137,31, instance_npcname("Miriam#dms101") + "::OnMove4";
	end;
OnMove4:
	disablenpc instance_npcname("Miriam#dms101");
	end;

OnGuy1:
	disablenpc instance_npcname("Lamacus#dms102");
	end;
OnGuy2:
	disablenpc instance_npcname("Kun#dms112");
	end;
OnGuy3:
	disablenpc instance_npcname("Yopi#dms122");
	end;
}

1@nyr,125,41,3	script	Suad#dms101	4_EP18_SUAD,{
	if (is_party_leader() == false) {
		cutin "ep18_Suad_01.png",0;
		mes "[苏阿德]";
		mes "党的领导人在哪里？";
		close3;
	}
	if ('nyr_main_step == 2) {
		cutin "ep18_suad_01.png",0;
		mes "[苏阿德]";
		mes "现在看起来不太好。我认为...武装警卫加强了他们的安全..";
		next;
		select( "看来上面的骚乱问题是个大问题。" );
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "或者说信息被泄露了。否则，我们就不会做好准备。";
		next;
		cutin "",255;
		mes "[圣殿守卫]";
		mes "不允许进一步进入。屈服于你的逮捕。";
		next;
		mes "[当地人]";
		mes "我们做了什么？我们不应该在这里！";
		next;
		mes "[当地人]";
		mes "这是我们的土地！如果主人想进入自己的土地，为什么有人要阻止他们呢？";
		next;
		mes "[当地人]";
		mes "你们才是非法侵占的人！";
		next;
		mes "[当地人]";
		mes "What the hell, give it back!!我们的土地！！";
		next;
		mes "[本土领袖]";
		mes "我们是这片土地的长期所有者，并被定居者从家园中流离失所。";
		next;
		mes "[本土领袖]";
		mes "作为这片土地上的长期居民，我们来到这里，要求拥有应有的地位。";
		next;
		mes "[本土领袖]";
		mes "我们的要求如下。";
		next;
		mes "[本土领袖]";
		mes "一！我们有...";
		next;
		npctalk "现在是时候了。静静地跟着我。", instance_npcname("拉马库斯#dms102");
		npcspeed( 50, instance_npcname("Lamacus#dms102") );
		npcspeed( 50, instance_npcname("Kun#dms112") );
		npcspeed( 50, instance_npcname("Yopi#dms122") );
		unitwalk getnpcid(0,instance_npcname("Lamacus#dms102")), 145,34, instance_npcname("Miriam#dms101") + "::OnGuy1";
		sleep2 1000;
		unitwalk getnpcid(0,instance_npcname("Kun#dms112")), 145,32, instance_npcname("Miriam#dms101") + "::OnGuy2";
		unitwalk getnpcid(0,instance_npcname("Yopi#dms122")), 145,31, instance_npcname("Miriam#dms101") + "::OnGuy3";
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "Suad，你有没有向高层暴乱的人发出任何具体指示？";
		next;
		cutin "ep18_suad_01.png",0;
		mes "[苏阿德]";
		mes "不？为什么？";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "看到那边那些人了吗？他们行动小心翼翼。这就是对顶部发动袭击的组织。";
		next;
		cutin "ep18_suad_03.png",0;
		mes "[苏阿德]";
		mes "我没有给你任何指示。你想自己行动吗？";
		next;
		select( "看来他们是要去圣殿了。" );
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "这是一个事先没有讨论过的行动。我已经有历史了，这不是一件好事，不是吗？我只能默默地走下去，我不知道我还能做什么。";
		next;
		cutin "ep18_suad_01.png",0;
		mes "[苏阿德]";
		mes "你一个人去吗？";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "我只是跟在后面，为什么需要一群人？我自己就够好了。你留在这儿，有什么事我会发出信号。";
		next;
		if ('nyr_main_step == 2) {
			'nyr_main_step = 3;
			enablenpc instance_npcname("#dmswp01");
			enablenpc instance_npcname("Miriam#dms201");
		}
		donpcevent instance_npcname("Miriam#dms101") + "::OnStartMove2";
		cutin "ep18_suad_03.png",0;
		mes "[苏阿德]";
		mes "他们说他们只是在跟踪，但不知道他们可能会做什么。即使他们手无寸铁，他们也可能隐藏着什么……";
		next;
		unittalk getcharid(3), "" + strcharinfo(0) + " : Let me catch up.";
		mes "[苏阿德]";
		mes "嗯，这真是一种解脱。我不能在这里做出任何仓促的举动。米丽亚姆留下了痕迹。现在帮我一个忙，顺着痕迹走。";
		close2;
		navigateto("1@nyr",179,164);
		cutin "",255;
		end;
	}
	if ('nyr_main_step == 3) {
		cutin "ep18_suad_01.png",0;
		mes "[苏阿德]";
		mes "当心。";
		close2;
		navigateto("1@nyr",179,164);
		cutin "",255;
		end;
	}
	end;
}

1@nyr,130,34,1	script	Lamacus#dms102	EP18_ARMED_VILLAGER01,{
	end;
OnInstanceInit:
	npcspeed 100;
	end;
}
1@nyr,132,32,1	duplicate(Lamacus#dms102)	Kun#dms112	EP18_ARMED_VILLAGER02
1@nyr,130,31,1	duplicate(Lamacus#dms102)	Yopi#dms122	EP18_ARMED_VILLAGER03

1@nyr,117,38,7	duplicate(dummy_npc)	Angry Crowd#dms171	4_EP18_GW_MIDDLE02
1@nyr,139,46,3	duplicate(dummy_npc)	Temple Guard#dms101	4_M_RASWORD
1@nyr,132,46,3	duplicate(dummy_npc)	Temple Guard#dms111	4_M_RASWORD
1@nyr,126,46,3	duplicate(dummy_npc)	Temple Guard#dms121	4_M_RASWORD
1@nyr,122,46,3	duplicate(dummy_npc)	Temple Guard#dms131	4_M_RASWORD
1@nyr,118,46,5	duplicate(dummy_npc)	Temple Guard#dms141	4_M_RASWORD
1@nyr,110,46,5	duplicate(dummy_npc)	Temple Guard#dms151	4_M_RASWORD

1@nyr,120,44,5	duplicate(dummy_npc)	Temple Guard#dms181	4_M_RASWORD
1@nyr,124,44,3	duplicate(dummy_npc)	Temple Guard#dms191	4_M_RASWORD
1@nyr,137,38,1	duplicate(dummy_npc)	Angry Crowd#dms101	4_EP18_GW_MAN01
1@nyr,124,36,1	duplicate(dummy_npc)	Angry Crowd#dms111	4_EP18_GW_WOMAN01
1@nyr,131,38,1	duplicate(dummy_npc)	Angry Crowd#dms121	4_EP18_GW_MAN02
1@nyr,127,34,1	duplicate(dummy_npc)	Angry Crowd#dms131	4_M_MIDDLE
1@nyr,121,40,7	duplicate(dummy_npc)	Angry Crowd#dms141	4_EP18_GW_WOMAN02
1@nyr,122,37,7	duplicate(dummy_npc)	Angry Crowd#dms151	4_EP18_GW_MIDDLE01
1@nyr,118,35,7	duplicate(dummy_npc)	Angry Crowd#dms161	4_M_RACHMAN1
1@nyr,114,36,7	duplicate(dummy_npc)	Angry Crowd#dms181	4_F_SHABBY
1@nyr,116,41,7	duplicate(dummy_npc)	Angry Crowd#dms191	4_EP18_GW_WOMAN01


//------------------------------------------------------------
// Step 2
//------------------------------------------------------------
// (disabled since we are using Miriam instead)
// 2@nyr,37,219,0	script	#ar101sw	HIDDEN_WARP_NPC,5,5

2@nyr,37,219,3	script	Miriam#dms201	4_EP18_MIRIAM,5,5,{
	end;
OnTouch:
	// note: player can move
	if ('nyr_main_step != 3 || is_party_leader() == false)
		end;
	'nyr_main_step = 4;
	npctalk "冒险家？", instance_npcname("米里亚姆#dms201");
	npctalk "冒险家？你为什么在这里？", instance_npcname("米里亚姆#dms201");
	sleep 2000;
	npctalk "我是苏阿德派来的。别太担心它。", instance_npcname("米里亚姆#dms201");
	sleep 1000;
	enablenpc instance_npcname("Temple Guard#dms201");
	enablenpc instance_npcname("Temple Guard#dms211");
	enablenpc instance_npcname("Temple Guard#dms221");
	enablenpc instance_npcname("Temple Guard#dms231");
	enablenpc instance_npcname("Temple Guard#dms241");
	sleep 500;
	npctalk "停止！确定你自己。", instance_npcname("圣殿守卫#dms201");
	npctalk "……安静地走过去，似乎很难。", instance_npcname("米里亚姆#dms201");
	end;
}

2@nyr,35,215,7	script	Temple Guard#dms201	4_M_RASWORD,{
	if (is_party_leader() == false) {
		npctalk "党的领袖是谁？";
		end;
	}
	if ('nyr_main_step != 4)
		end;
	mes "[圣殿守卫]";
	mes "这个地方是禁区。";
	next;
	cutin "ep18_miriam_01.png",2;
	mes "[米丽亚姆]";
	mes "我是米丽亚姆，大祭司阿迈勒的女儿。我们一直在跟踪一群可疑的人进入这个区域。";
	next;
	cutin "",255;
	mes "[圣殿守卫]";
	mes "你是来帮助大祭司工作的吗？";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "工作...帮忙...？我父亲在吗？";
	next;
	cutin "",255;
	mes "[圣殿守卫]";
	mes "啊...";
	next;
	mes "[圣殿守卫]";
	mes "这里没有人怀疑。你现在可以离开了。";
	next;
	mapannounce 'map_2nyr$, "Slowly.", bc_map, 0xFFCC;
	mapannounce 'map_2nyr$, "Please be careful.", bc_map, 0xFFCC;
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "你确定没有可疑的人进来吗？他们显然已经进入这个地方了，请稍等一下，我会尽快查看。";
	next;
	cutin "",255;
	mes "[圣殿守卫]";
	mes "如果你再靠近，我们就会采取行动。";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "……那就没办法了。你可以吗，冒险家？";
	next;
	select( "是的。我来处理，你去追他们。" );
	mes "[米丽亚姆]";
	mes "那么帮我一个忙，我会留下一条踪迹，这样你就可以找到我..";
	next;
	cutin "",255;
	disablenpc instance_npcname("Miriam#dms201");
	mes "[圣殿守卫]";
	mes "入侵者……！啊啊！！！";
	if ('nyr_main_step == 4) {
		'nyr_main_step = 5;
		donpcevent instance_npcname("nyr_step_2") + "::OnStart";
	}
	close;
}

2@nyr,34,212,7	duplicate(dummy_npc)	Temple Guard#dms211	4_M_RASWORD
2@nyr,36,212,1	duplicate(dummy_npc)	Temple Guard#dms221	4_M_RASWORD
2@nyr,33,209,7	duplicate(dummy_npc)	Temple Guard#dms231	4_M_RASWORD
2@nyr,38,209,1	duplicate(dummy_npc)	Temple Guard#dms241	4_M_RASWORD


2@nyr,1,1,0	script	nyr_step_2	-1,{
	end;
OnStart:
	// disabled npcs from step 1
	disablenpc instance_npcname("Miriam#dms101");
	disablenpc instance_npcname("Suad#dms101");
	disablenpc instance_npcname("Lamacus#dms102");
	disablenpc instance_npcname("Kun#dms112");
	disablenpc instance_npcname("Yopi#dms122");
	disablenpc instance_npcname("Angry Crowd#dms171");
	disablenpc instance_npcname("Temple Guard#dms101");
	disablenpc instance_npcname("Temple Guard#dms111");
	disablenpc instance_npcname("Temple Guard#dms121");
	disablenpc instance_npcname("Temple Guard#dms131");
	disablenpc instance_npcname("Temple Guard#dms141");
	disablenpc instance_npcname("Temple Guard#dms151");
	disablenpc instance_npcname("Temple Guard#dms181");
	disablenpc instance_npcname("Temple Guard#dms191");
	disablenpc instance_npcname("Angry Crowd#dms101");
	disablenpc instance_npcname("Angry Crowd#dms111");
	disablenpc instance_npcname("Angry Crowd#dms121");
	disablenpc instance_npcname("Angry Crowd#dms131");
	disablenpc instance_npcname("Angry Crowd#dms141");
	disablenpc instance_npcname("Angry Crowd#dms151");
	disablenpc instance_npcname("Angry Crowd#dms161");
	disablenpc instance_npcname("Angry Crowd#dms181");
	disablenpc instance_npcname("Angry Crowd#dms191");
	disablenpc instance_npcname("#dmswp01");

	disablenpc instance_npcname("Miriam#dms201");
	disablenpc instance_npcname("Temple Guard#dms201");
	disablenpc instance_npcname("Temple Guard#dms211");
	disablenpc instance_npcname("Temple Guard#dms221");
	disablenpc instance_npcname("Temple Guard#dms231");
	disablenpc instance_npcname("Temple Guard#dms241");
	sleep 500;
	.@label$ = instance_npcname("nyr_step_2") + "::OnMobDead";
	monster 'map_2nyr$,35,215,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,34,212,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,36,212,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,33,209,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,38,209,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	end;
OnMobDead:
	if ('nyr_main_step != 5)
		end;
	if (mobcount('map_2nyr$, instance_npcname("nyr_step_2") + "::OnMobDead") < 1) {
		'nyr_main_step = 6;
		mapannounce 'map_2nyr$, "I heard a fight somewhere?", bc_map, 0xFFCC;
		enablenpc instance_npcname("#mstep01");
		enablenpc instance_npcname("Miriam#dms301");
		enablenpc instance_npcname("Lamacus#dms201");
		enablenpc instance_npcname("Yopi#dms221");
		enablenpc instance_npcname("Kun#dms211");
		enablenpc instance_npcname("#msna01");
	}
	end;
}

2@nyr,37,145,0	script	#msna01	HIDDEN_WARP_NPC,5,5,{
	end;
OnTouch:
	if ('nyr_main_step == 6)
		navigateto("2@nyr",56,104);
	end;
}


//------------------------------------------------------------
// Step 3
//------------------------------------------------------------
2@nyr,43,94,3	script	Miriam#dms301	4_EP18_MIRIAM,5,5,{
	end;
OnTouch:
	if ('nyr_main_step != 6)
		end;
	npctalk "您来对地方了。嘘——你看到那边那些人了吗？", instance_npcname("米里亚姆#dms301");
	npctalk "书香使我昏昏欲睡。", instance_npcname("拉马库斯#dms201");
	end;
}

2@nyr,37,93,5	script	Lamacus#dms201	EP18_ARMED_VILLAGER01,{
	if ('nyr_main_step != 6)
		end;
	if (is_party_leader() == false)
		end;
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "你在这里做什么？";
	next;
	cutin "",255;
	mes "[拉马库斯]";
	mes "哇！你和一个冒险家来这里到底做什么？";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "你现在不应该在这里。如果圣殿知道了，只会让我们的处境更加困难。";
	next;
	cutin "",255;
	mes "[拉马库斯]";
	mes "你没看到吗？我们正在闯入图书馆。这里一定有很多定居者的秘密。";
	npctalk "想一想。如果我们掌握了这一切怎么办？", instance_npcname("什么时候#dms211");
	npctalk "我们可以利用他们的弱点！", instance_npcname("约皮#dms221");
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "我们可以稍后再考虑。目前。回去。你现在的行为可能会让我们陷入更加危险的境地。";
	next;
	cutin "",255;
	mes "[尤皮]";
	mes "回家吧，米丽亚姆。我不会再配合你这种闷骚的行为了。";
	npctalk "你是谁来告诉我们该怎么做？", instance_npcname("什么时候#dms211");
	next;
	enablenpc instance_npcname("Temple Guard#dms301");
	mes "[圣殿守卫]";
	mes "在那里，入侵者！";
	next;
	enablenpc instance_npcname("Temple Guard#dms311");
	enablenpc instance_npcname("Temple Guard#dms321");
	enablenpc instance_npcname("Temple Guard#dms331");
	enablenpc instance_npcname("Temple Guard#dms341");
	mes "[圣殿守卫]";
	mes "大家放下武器，举起双手！";
	next;
	select( "我该怎么做？" );
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "我们寡不敌众，我们来应对吧。";
	next;
	cutin "",255;
	mes "[仅]";
	mes "时机很好。那我们就说再见了！";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "坚持住，冒险家！";
	next;
	select( "这个就交给我吧！" );
	if ('nyr_main_step == 6) {
		'nyr_main_step = 7;
		donpcevent instance_npcname("nyr_step_3") + "::OnStart";
	}
	cutin "",255;
	end;
}

2@nyr,35,90,5	duplicate(dummy_npc)	Yopi#dms221	EP18_ARMED_VILLAGER03
2@nyr,32,93,1	duplicate(dummy_npc)	Kun#dms211	EP18_ARMED_VILLAGER02

2@nyr,1,1,0	script	nyr_step_3	-1,{
	end;
OnStart:
	disablenpc instance_npcname("Miriam#dms301");
	disablenpc instance_npcname("Lamacus#dms201");
	disablenpc instance_npcname("Yopi#dms221");
	disablenpc instance_npcname("Kun#dms211");
	disablenpc instance_npcname("Temple Guard#dms301");
	disablenpc instance_npcname("Temple Guard#dms311");
	disablenpc instance_npcname("Temple Guard#dms321");
	disablenpc instance_npcname("Temple Guard#dms331");
	disablenpc instance_npcname("Temple Guard#dms341");
	.@label$ = instance_npcname("nyr_step_3") + "::OnMobDead";
	monster 'map_2nyr$,45,96,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,47,94,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,43,96,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,47,98,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,44,98,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	end;
OnMobDead:
	if ('nyr_main_step != 7)
		end;
	if (mobcount('map_2nyr$, instance_npcname("nyr_step_3") + "::OnMobDead") < 1) {
		'nyr_main_step = 8;
		mapannounce 'map_2nyr$, "I feel a chill down my spine... Like someone's watching...?", bc_map, 0xFFCC;
		disablenpc instance_npcname("#mstep01");
		enablenpc instance_npcname("#mstep02");
		enablenpc instance_npcname("#mstep03");
		enablenpc instance_npcname("Miriam#dms401");
		enablenpc instance_npcname("Lamacus#dms301");
		enablenpc instance_npcname("Kun#dms311");
		enablenpc instance_npcname("Yopi#dms321");
	}
	end;
}

2@nyr,45,96,3	duplicate(dummy_npc)	Temple Guard#dms301	4_M_RASWORD
2@nyr,47,94,3	duplicate(dummy_npc)	Temple Guard#dms311	4_M_RASWORD
2@nyr,43,96,3	duplicate(dummy_npc)	Temple Guard#dms321	4_M_RASWORD
2@nyr,47,98,3	duplicate(dummy_npc)	Temple Guard#dms331	4_M_RASWORD
2@nyr,44,98,3	duplicate(dummy_npc)	Temple Guard#dms341	4_M_RASWORD


//------------------------------------------------------------
// Step 4
//------------------------------------------------------------
2@nyr,87,47,5	script	Miriam#dms401	4_EP18_MIRIAM,5,5,{
	end;
OnTouch:
	npctalk "有声音从这边传来。", instance_npcname("米里亚姆#dms401");
	npctalk "那个……心……", instance_npcname("拉马库斯#dms301");
	end;
}

2@nyr,99,47,1	script	Lamacus#dms301	EP18_ARMED_VILLAGER01,{
	if ('nyr_main_step != 8)
		end;
	if (is_party_leader() == false)
		end;
	mes "[拉马库斯]";
	mes "你找到了吗？这是一个什么样的地方？";
	next;
	mes "[仅]";
	mes "还没有。我认为不是在这一边。哦，等等……大祭司的……？";
	next;
	mes "[尤皮]";
	mes "留下不相关的书。那不是我们要找的。";
	next;
	cutin "ep18_miriam_03.png",0;
	mes "[米丽亚姆]";
	mes "你们……！";
	next;
	select( "嘘——等一下。" );
	cutin "",255;
	mes "[拉马库斯]";
	mes "即使是最隐秘的图书馆也不会随便乱放这样的书。";
	next;
	mes "[仅]";
	mes "那么秘库之中是否还有另一个秘库呢？";
	next;
	mes "[尤皮]";
	mes "我不知道。让我们找到它吧。";
	next;
	mes "[仅]";
	mes "如果知道书名就好了。";
	next;
	mes "[拉马库斯]";
	mes "如果我知道的话，我就不会在这里了。我会说，“给我带来任何看起来像那样的东西。”去找吧。";
	next;
	select( "他们看起来不像是在寻找一本特定的书吗？" );
	mes "[米丽亚姆]";
	mes "特定的书...？不只是一本利用弱点的书吗？";
	next;
	cutin "ep18_miriam_03.png",0;
	mes "[米丽亚姆]";
	mes "不，你是说这个吗？嘿！你要买什么？出于什么目的？";
	next;
	cutin "",255;
	mes "[尤皮]";
	mes "哦，你又来了！你为什么要偷听？就好像你有什么阴暗的东西要分享一样。";
	npctalk "你为什么一直跟着我？你为什么老是打断我？", instance_npcname("什么时候#dms311");
	next;
	cutin "ep18_miriam_03.png",0;
	mes "[米丽亚姆]";
	mes "你们就是那些带着见不得光的东西偷偷溜进来的人，还记得吗？您要找的书是什么？";
	next;
	cutin "",255;
	mes "[拉马库斯]";
	mes "这真的很痛苦，伙计。难道你没有意识到我们正试图利用这件事来做一件好事吗？难道你不明白我们正在努力为每个人创造更好的生活吗？";
	npctalk "你在给我们安排吗？", instance_npcname("约皮#dms321");
	npctalk "他们对我们说了什么？", instance_npcname("什么时候#dms311");
	next;
	mes "[拉马库斯]";
	mes "他们永远不会知道我们有多关心。顺便说一句，你也到了该出现的时候了……";
	next;
	cutin "ep18_miriam_03.png",0;
	mes "[米丽亚姆]";
	mes "你必须抓住他们并让他们张开嘴......！";
	next;
	enablenpc instance_npcname("Temple Guard#dms401");
	enablenpc instance_npcname("Temple Guard#dms411");
	enablenpc instance_npcname("Temple Guard#dms421");
	enablenpc instance_npcname("Temple Guard#dms431");
	enablenpc instance_npcname("Temple Guard#dms441");
	cutin "",255;
	mes "[圣殿守卫]";
	mes "开始了！入侵者来了！！！";
	npctalk "开始了！！！祝你好运！我们走吧，孩子们！", instance_npcname("拉马库斯#dms301");
	npctalk "我会追踪他们，而你，冒险家，解决掉这些家伙！", instance_npcname("米里亚姆#dms401");
	next;
	mes "[圣殿守卫]";
	mes "放下你的武器！！";
	if ('nyr_main_step == 8) {
		'nyr_main_step = 9;
		donpcevent instance_npcname("nyr_step_4") + "::OnStart";
	}
	close;
}

2@nyr,93,36,3	duplicate(dummy_npc)	Kun#dms311	EP18_ARMED_VILLAGER02
2@nyr,99,38,5	duplicate(dummy_npc)	Yopi#dms321	EP18_ARMED_VILLAGER03
2@nyr,88,44,5	duplicate(dummy_npc)	Temple Guard#dms401	4_M_RASWORD
2@nyr,87,46,5	duplicate(dummy_npc)	Temple Guard#dms411	4_M_RASWORD
2@nyr,87,42,5	duplicate(dummy_npc)	Temple Guard#dms421	4_M_RASWORD
2@nyr,85,46,5	duplicate(dummy_npc)	Temple Guard#dms431	4_M_RASWORD
2@nyr,85,42,5	duplicate(dummy_npc)	Temple Guard#dms441	4_M_RASWORD


2@nyr,1,1,0	script	nyr_step_4	-1,{
	end;
OnStart:
	disablenpc instance_npcname("Miriam#dms401");
	disablenpc instance_npcname("Lamacus#dms301");
	disablenpc instance_npcname("Kun#dms311");
	disablenpc instance_npcname("Yopi#dms321");
	disablenpc instance_npcname("Temple Guard#dms401");
	disablenpc instance_npcname("Temple Guard#dms411");
	disablenpc instance_npcname("Temple Guard#dms421");
	disablenpc instance_npcname("Temple Guard#dms431");
	disablenpc instance_npcname("Temple Guard#dms441");
	.@label$ = instance_npcname("nyr_step_4") + "::OnMobDead";
	monster 'map_2nyr$,88,44,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,87,46,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,87,42,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,85,46,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,85,42,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	end;
OnMobDead:
	if ('nyr_main_step != 9)
		end;
	if (mobcount('map_2nyr$, instance_npcname("nyr_step_4") + "::OnMobDead") < 1) {
		'nyr_main_step = 10;
		mapannounce 'map_2nyr$, "It's ominous. I feel as though it's still following us.", bc_map, 0xFFCC;
		disablenpc instance_npcname("#mstep02");
		disablenpc instance_npcname("#mstep03");
		enablenpc instance_npcname("#mstep04");
		enablenpc instance_npcname("#mstep05");
		enablenpc instance_npcname("Miriam#dms501");
		enablenpc instance_npcname("Lamacus#dms401");
		enablenpc instance_npcname("Kun#dms411");
		enablenpc instance_npcname("Yopi#dms421");
	}
	end;
}


//------------------------------------------------------------
// Step 5
//------------------------------------------------------------
2@nyr,209,98,5	script	Miriam#dms501	4_EP18_MIRIAM,5,5,{
	if (is_party_leader() == false)
		npctalk "党的领导不是决定来了吗？", instance_npcname("米里亚姆#dms501");
	end;
OnTouch:
	npctalk "看到那边的架子了吗？", instance_npcname("米里亚姆#dms501");
	npctalk "我要烧坏我的手指了。", instance_npcname("拉马库斯#dms401");
	end;
}

2@nyr,212,104,1	script	Lamacus#dms401	EP18_ARMED_VILLAGER01,{
	if ('nyr_main_step != 10)
		end;
	if (is_party_leader() == false)
		end;
	mes "[尤皮]";
	mes "这不是已经结束了吗？";
	next;
	mes "[拉马库斯]";
	mes "我知道。他们一定有一个真正的秘密图书馆。";
	npctalk "哎呀，那真是浪费了。", instance_npcname("约皮#dms421");
	npctalk "你不会让我对失败负责吧？", instance_npcname("什么时候#dms411");
	next;
	mes "[拉马库斯]";
	mes "我告诉过你首先要找到它，而不是因为它就在那里才来找我。";
	next;
	mes "[仅]";
	mes "询问是否可以退出。";
	next;
	npctalk "这是狼。", instance_npcname("拉马库斯#dms401");
	sleep2 2000;
	npctalk "？？？：你找到这个东西了吗？", instance_npcname("拉马库斯#dms401");
	sleep2 2000;
	npctalk "这是最后一个图书馆，但我认为它不在这里。", instance_npcname("拉马库斯#dms401");
	sleep2 2000;
	npctalk "？？？： 等待。", instance_npcname("拉马库斯#dms401");
	mes "[仅]";
	mes "等等，我是不是看到了什么东西？那就是米丽亚姆和冒险家。";
	npctalk "你很执着。我很惊讶你打败了所有的守卫。", instance_npcname("约皮#dms421");
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "你们在跟谁说话？";
	next;
	select( "你们这样做有报酬吗？" );
	cutin "",255;
	mes "[拉马库斯]";
	mes "支付？我们不明白，是吗？";
	npctalk "我有点相信。", instance_npcname("什么时候#dms411");
	npctalk "我们永远不会背叛。", instance_npcname("约皮#dms421");
	next;
	enablenpc instance_npcname("Temple Guard#dms501");
	enablenpc instance_npcname("Temple Guard#dms511");
	enablenpc instance_npcname("Temple Guard#dms521");
	enablenpc instance_npcname("Temple Guard#dms531");
	enablenpc instance_npcname("Temple Guard#dms541");
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms501")),203,95;
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms511")),201,96;
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms521")),201,93;
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms531")),199,98;
	unitwalk getnpcid(0,instance_npcname("Temple Guard#dms541")),199,92;

	sleep2 500;
	npctalk "在这里！", instance_npcname("圣殿守卫#dms501");
	npctalk "嘿！你在那里！", instance_npcname("拉马库斯#dms401");
	sleep2 1000;
	enablenpc instance_npcname("Schulang#dms101");
	unitwalk getnpcid(0,instance_npcname("Schulang#dms101")),206,96;
	npctalk "......", instance_npcname("舒朗#dms101");
	npctalk "你来了！", instance_npcname("拉马库斯#dms401");
	npctalk "你来了！", instance_npcname("什么时候#dms411");
	npctalk "你来了！", instance_npcname("约皮#dms421");
	sleep2 2000;

	cutin "ep18_shulang.png",0;
	mes "[??]";
	mes "这是图书馆的尽头吗？";
	next;
	cutin "",255;
	mes "[拉马库斯]";
	mes "是的。";
	next;
	cutin "ep18_shulang.png",0;
	mes "[??]";
	mes "我希望我能找到这本书，但我找不到。他们已经完成了他们的工作，所以我们离开这里。";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "你是谁？你和这些人有什么关系？";
	next;
	cutin "ep18_shulang.png",0;
	mes "[??]";
	mes "它是什么？还有别的事吗？";
	next;
	cutin "",255;
	mes "[尤皮]";
	mes "有人嗅出了狼的气味，决定跟着我们。我们会尽快处理的。";
	next;
	cutin "ep18_shulang.png",0;
	mes "[??]";
	mes "那没有必要。你们应该离开这里，让新人接管。";
	next;
	cutin "",255;
	mes "[拉马库斯]";
	mes "是的！！";
	next;
	disablenpc instance_npcname("Schulang#dms101");
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "等待！！！";
	next;
	cutin "",255;
	mes "[圣殿守卫]";
	mes "小心所有入侵者！";
	unittalk getcharid(3), "" + strcharinfo(0) + " : Who's the intruder?";
	next;
	cutin "ep18_miriam_03.png",2;
	mes "[米丽亚姆]";
	mes "这似乎是一个奇怪的命运转折，是吧？圣殿守卫已被收买。我们需要找出发生了什么事......";
	unittalk getcharid(3), "" + strcharinfo(0) + " : Leave these people to me.";
	next;
	cutin "",255;
	mes "[圣殿守卫]";
	mes "全体双手列队！";
	next;
	mes "[尤皮]";
	mes "噢，不~对不起，我们擦肩而过，我们都脏了，所以我们不要再见面了？";
	if ('nyr_main_step == 10) {
		'nyr_main_step = 11;
		donpcevent instance_npcname("nyr_step_5") + "::OnStart";
	}
	close;
}

2@nyr,220,98,5	duplicate(dummy_npc)	Kun#dms411	EP18_ARMED_VILLAGER02
2@nyr,220,95,5	duplicate(dummy_npc)	Yopi#dms421	EP18_ARMED_VILLAGER03

2@nyr,197,96,5	duplicate(dummy_npc)	Schulang#dms101	EP18_MD_SCHULANG
2@nyr,197,95,5	duplicate(dummy_npc)	Temple Guard#dms501	EP18_MD_GUARD_A
2@nyr,197,96,5	duplicate(dummy_npc)	Temple Guard#dms511	EP18_MD_GUARD_A
2@nyr,197,93,5	duplicate(dummy_npc)	Temple Guard#dms521	EP18_MD_GUARD_A
2@nyr,197,98,5	duplicate(dummy_npc)	Temple Guard#dms531	EP18_MD_GUARD_A
2@nyr,197,92,5	duplicate(dummy_npc)	Temple Guard#dms541	EP18_MD_GUARD_A


2@nyr,1,1,0	script	nyr_step_5	-1,{
	end;
OnStart:
	disablenpc instance_npcname("Temple Guard#dms501");
	disablenpc instance_npcname("Temple Guard#dms511");
	disablenpc instance_npcname("Temple Guard#dms521");
	disablenpc instance_npcname("Temple Guard#dms531");
	disablenpc instance_npcname("Temple Guard#dms541");
	disablenpc instance_npcname("Lamacus#dms401");
	disablenpc instance_npcname("Kun#dms411");
	disablenpc instance_npcname("Yopi#dms421");
	disablenpc instance_npcname("Miriam#dms501");
	.@label$ = instance_npcname("nyr_step_5") + "::OnMobDead";

	monster 'map_2nyr$,203,95,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,201,96,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,201,93,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,199,98,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,199,92,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	end;
OnMobDead:
	if ('nyr_main_step != 11)
		end;
	if (mobcount('map_2nyr$, instance_npcname("nyr_step_5") + "::OnMobDead") < 1) {
		'nyr_main_step = 12;
		mapannounce 'map_2nyr$, "Beep - Vault unlock protocol activated", bc_map, 0xFFCC;
		disablenpc instance_npcname("#mstep04");
		disablenpc instance_npcname("#mstep05");

		enablenpc instance_npcname("#mstep06");
		enablenpc instance_npcname("Miriam#dms601");
		enablenpc instance_npcname("Lamacus#dms501");
		enablenpc instance_npcname("Kun#dms511");
		enablenpc instance_npcname("Yopi#dms521");
		enablenpc instance_npcname("Schulang#dms201");
		enablenpc instance_npcname("Bagot#dms101");
		enablenpc instance_npcname("Private Officer#dms101");
		enablenpc instance_npcname("Temple Guard#dms601");
		enablenpc instance_npcname("Temple Guard#dms611");
		enablenpc instance_npcname("Temple Guard#dms621");
	}
	end;
}


//------------------------------------------------------------
// Step 6
//------------------------------------------------------------
// 2@nyr,132,108,0	duplicate(dummy_npc)	#dmss101	HIDDEN_WARP_NPC,3,3

2@nyr,133,109,3	script	Miriam#dms601	EP18_NPC_MIRIAM,5,5,{
	if (is_party_leader() == false) {
		npctalk "我认为聚会还没有到来。";
		end;
	}
	.@miriam$ = instance_npcname("Miriam#dms601");

	if ('nyr_main_step == 12) {
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "你在干什么？有多少人？从这里我看不到太多东西。";
		next;
		select( "有几个人我不认识。" );
		cutin "ep18_shulang.png",1;
		mes "[???]";
		mes "我们离那里还有多远？";
		next;
		cutin "",255;
		mes "[拉马库斯]";
		mes "我们快到了。";
		next;
		cutin "ep18_bagot_01.png",1;
		mes "[???]";
		mes "它真的非常非常安全。我只是说说而已。";
		next;
		cutin "",255;
		mes "[???]";
		mes "……至少你还没有这么安全吗？";
		next;
		cutin "ep18_bagot_02.png",1;
		mes "[???]";
		mes "嘿，天才先生，你不会讽刺吗？！严格的安全性并不意味着繁琐和苛刻的程序，对吗？";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "这个声音是……";
		donpcevent .@miriam$ + "::OnEffect";
		next;
		select( "你认识他们吗？" );
		mes "[米丽亚姆]";
		mes "太模糊了，所以我不确定...";
		next;
		cutin "",255;
		mes "[???]";
		mes "进入。";
		close2;
		if ('nyr_main_step != 12)
			end;
		'nyr_main_step = 13;
		disablenpc instance_npcname("#mstep06");
		enablenpc instance_npcname("#mstep07");
		enablenpc instance_npcname("#mstep08");

		enablenpc instance_npcname("Miriam#dms701");
		enablenpc instance_npcname("Lamacus#dms601");
		enablenpc instance_npcname("Kun#dms611");
		enablenpc instance_npcname("Yopi#dms621");
		enablenpc instance_npcname("Schulang#dms301");
		enablenpc instance_npcname("Bagot#dms201");
		enablenpc instance_npcname("Temple Guard#dms721");
		enablenpc instance_npcname("Temple Guard#dms731");
		enablenpc instance_npcname("Temple Guard#dms741");

		npcspeed( 150, instance_npcname("Kun#dms511") );
		npcspeed( 150, instance_npcname("Yopi#dms521") );
		npcspeed( 150, instance_npcname("Schulang#dms201") );

		unitwalk getnpcid(0,instance_npcname("Lamacus#dms501")), 120,120, .@miriam$ + "::OnMove1";
		sleep 2000;
		unitwalk getnpcid(0,instance_npcname("Kun#dms511")), 120,121, .@miriam$ + "::OnMove2";
		unitwalk getnpcid(0,instance_npcname("Yopi#dms521")), 122,121, .@miriam$ + "::OnMove3";
		sleep 1000;
		unitwalk getnpcid(0,instance_npcname("Schulang#dms201")), 120,121, .@miriam$ + "::OnMove4";
		sleep 500;
		disablenpc instance_npcname("Bagot#dms101");
		disablenpc instance_npcname("Private Officer#dms101");
		end;
	}
	if ('nyr_main_step == 13) {
		npctalk "这边走！赶紧去追他吧！";
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "我们也进去吧。";
		sleep2 1000;
		unitwalk getnpcid(0,instance_npcname("Temple Guard#dms601")), 118,121, .@miriam$ + "::OnMove5";
		unitwalk getnpcid(0,instance_npcname("Temple Guard#dms611")), 118,121, .@miriam$ + "::OnMove6";
		unitwalk getnpcid(0,instance_npcname("Temple Guard#dms621")), 117,121, .@miriam$ + "::OnMove7";
		close2;
		unitwalk getnpcid(0,.@miriam$), 122,119, .@miriam$ + "::OnMove8";
		cutin "",255;
		end;
	}
	end;

OnEffect:
	enablenpc instance_npcname("#effc01");
	specialeffect EF_MAPPILLAR2, AREA, instance_npcname("#effc01");
	sleep 1000;
	npctalk "静-拍手-", instance_npcname("#effc01");
	end;

OnMove1:
	disablenpc instance_npcname("Lamacus#dms501");
	end;
OnMove2:
	disablenpc instance_npcname("Kun#dms511");
	end;
OnMove3:
	disablenpc instance_npcname("Yopi#dms521");
	end;
OnMove4:
	disablenpc instance_npcname("Schulang#dms201");
	end;
OnMove5:
	disablenpc instance_npcname("Temple Guard#dms601");
	end;
OnMove6:
	disablenpc instance_npcname("Temple Guard#dms611");
	end;
OnMove7:
	disablenpc instance_npcname("Temple Guard#dms621");
	end;
OnMove8:
	disablenpc instance_npcname("Miriam#dms601");
	end;

OnTouch:
	if ('nyr_main_step == 12)
		npctalk "嘿，那边还有其他人，他们说什么？", instance_npcname("米里亚姆#dms601");
	end;
}
2@nyr,125,111,3	duplicate(dummy_npc)	Lamacus#dms501	EP18_ARMED_VILLAGER01
2@nyr,128,107,3	duplicate(dummy_npc)	Kun#dms511	EP18_ARMED_VILLAGER02
2@nyr,128,104,3	duplicate(dummy_npc)	Yopi#dms521	EP18_ARMED_VILLAGER03
2@nyr,125,101,1	duplicate(dummy_npc)	Schulang#dms201	EP18_MD_SCHULANG
2@nyr,122,106,3	duplicate(dummy_npc)	Bagot#dms101	4_EP18_BAGOT
2@nyr,120,107,3	duplicate(dummy_npc)	Private Officer#dms101	4_M_RACHOLD
2@nyr,115,102,5	duplicate(dummy_npc)	Temple Guard#dms601	EP18_MD_GUARD_A
2@nyr,116,106,5	duplicate(dummy_npc)	Temple Guard#dms611	EP18_MD_GUARD_A
2@nyr,117,98,7	duplicate(dummy_npc)	Temple Guard#dms621	EP18_MD_GUARD_A
2@nyr,119,103,0	duplicate(dummy_npc)	#effc01	HIDDEN_WARP_NPC



//------------------------------------------------------------
// Step 7 + 8
//------------------------------------------------------------
// 2@nyr,118,199,0	duplicate(dummy_npc)	#dms701	HIDDEN_WARP_NPC,1,5

2@nyr,118,199,1	script	Miriam#dms701	4_EP18_MIRIAM,5,5,{
	if (is_party_leader() == false) {
		npctalk "党的领袖是谁？";
		end;
	}
	if ('nyr_main_step == 13) {
		mes "[???]";
		mes "舒朗，你拿到了吗？这个巴戈特快要失去耐心了。";
		next;
		mes "[拉马库斯]";
		mes "但我们必须继续这样吗？";
		npctalk "真令人沮丧。", instance_npcname("约皮#dms621");
		next;
		cutin "ep18_shulang.png",0;
		mes "[舒朗]";
		mes "谁在乎？你已经走到这一步了。随你便吧。";
		next;
		setnpcdisplay( instance_npcname("Lamacus#dms601"), 21308 );	// EP18_MD_HEARTHUNTER_A
		setnpcdisplay( instance_npcname("Kun#dms611"), 21308 );	// EP18_MD_HEARTHUNTER_A
		setnpcdisplay( instance_npcname("Yopi#dms621"), 21308 );	// EP18_MD_HEARTHUNTER_A
		cutin "",255;
		mes "[尤皮]";
		mes "哈——现在这是救星了。";
		npctalk "我以为它要杀了我！", instance_npcname("什么时候#dms611");
		next;
		select( "猎心者是卧底。" );
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "猎心者...你正在与你所说的那些疯狂科学家一起工作...从一开始...！";
		next;
		cutin "",255;
		mes "[" + strcharinfo(0) + "]";
		mes "现在还有很多用尤弥尔的心脏改造的猎心者吧？";
		next;
		cutin "ep18_shulang.png",0;
		mes "[舒朗]";
		mes "这是我们的旧面孔吗？啊，那些据说是在跟踪你的小薯条。我听到这个消息了。";
		npctalk "哦，那些人？他们如此无情地追捕我们，连我们自己都感到惊讶。我们没有意识到我们负债累累。", instance_npcname("巴戈特#dms201");
		next;
		select( "那将是幻觉。" );
		cutin "ep18_bagot_02.png",1;
		mes "[袋子]";
		mes "哦天哪，我不想让你难堪。";
		npctalk "谁在乎呢，反正都会消失的。", instance_npcname("舒朗#dms301");
		next;
		enablenpc instance_npcname("High Priest#dms201");
		enablenpc instance_npcname("Temple Guard#dms701");
		enablenpc instance_npcname("Temple Guard#dms711");
		cutin "",255;
		mes "[???]";
		mes "你们都可以走了。";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "...父亲？？";
		next;
		cutin "",255;
		mes "[阿迈勒]";
		mes "米里亚姆，你已经走到这一步了。你已经完成了你的部分，现在回家吧。";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "你是什​​么意思？你在干什么...？";
		next;
		cutin "ep18_bagot_03.png",1;
		mes "[袋子]";
		mes "哇，你被你爸爸夸奖了。那太棒了。对于良好的养育方式的赞美，这很重要。";
		mes "我什至不记得得到过我的赞扬。嗯……啊！我不记得了，因为我从来没有得到过。";
		npctalk "现在你已经被表扬了，你可以回家洗脚睡觉了。", instance_npcname("巴戈特#dms201");
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "什么，发生什么事了？为什么我爸爸...你做了什么？";
		next;
		cutin "",255;
		mes "[阿迈勒]";
		mes "...一旦你得到了你需要的东西，我们就继续吧。";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "父亲！父亲！！！";
		next;
		disablenpc instance_npcname("High Priest#dms201");
		cutin "ep18_bagot_01.png",1;
		mes "[袋子]";
		mes "一个夸奖你但从不爱你的父亲？";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "你对我父亲做什么？";
		next;
		cutin "ep18_bagot_03.png",1;
		mes "[袋子]";
		mes "哦，你不知道，是吗？他的愿望是将所有土著赶出阿鲁纳费尔茨。我们在这方面提供了一些帮助，但不是免费的。";
		npctalk "你应该永远做你想做的事。否则，你会生病的。", instance_npcname("巴戈特#dms201");
		npctalk "呵呵——你喜欢你的模仿吗？拍拍我们的背吧。", instance_npcname("拉马库斯#dms601");
		next;
		cutin "",255;
		mes "[心脏猎手]";
		mes "米里亚姆，你和你的朋友帮助我完成了这张骚乱的照片。太感谢了！";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "你认为这有道理吗？";
		next;
		cutin "ep18_bagot_01.png",1;
		mes "[袋子]";
		mes "你在说什么，对寺庙的一些冲动的抗议？";
		next;
		cutin "ep18_bagot_03.png",1;
		mes "[袋子]";
		mes "很快外面的抗议就会变成骚乱，然后你的愿望就会实现，然后你再许一个愿望，然后我们又会得到报酬？";
		next;
		cutin "ep18_shulang.png",0;
		mes "[舒朗]";
		mes "我不会永远说话。我们走吧。";
		mes "清理你的烂摊子。";
		next;
		cutin "",255;
		mes "[拉马库斯]";
		mes "四！";
		next;
		disablenpc instance_npcname("Schulang#dms301");
		disablenpc instance_npcname("Bagot#dms201");
		mes "[心脏猎手]";
		mes "我希望苏阿德能和我在一起。我希望有一天我能帮助他。";
		next;
		mes "[心脏猎手]";
		mes "大家好，让我正式介绍一下自己。我们是猎心者，我们要把你埋在这里。";
		npctalk "不只是任何心灵猎人。他是一位非常非常优秀的猎心者。", instance_npcname("什么时候#dms611");
		next;
		select( "请注意，它们已被修改。" );
		next;
		specialeffect EF_UNDEADBODY, AREA, instance_npcname("Lamacus#dms601");
		specialeffect EF_NPC_STOP, AREA, instance_npcname("Lamacus#dms601");
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "他一直都是这样……是不是有什么不祥之兆？";
		next;
		select( "这里似乎与尤弥尔的内心产生了共鸣。" );
		mes "[米丽亚姆]";
		mes "这基本上是一个快速计数，对吧？好吧，让我们快点继续吧。";
		if ('nyr_main_step == 13) {
			'nyr_main_step = 14;
			donpcevent instance_npcname("nyr_step_7") + "::OnStart";
			removespecialeffect EF_UNDEADBODY, AREA, instance_npcname("Lamacus#dms601");
			removespecialeffect EF_NPC_STOP, AREA, instance_npcname("Lamacus#dms601");
		}
		close3;
	}
	if ('nyr_main_step == 15) {
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "哈……哈……冒险家，你还好吗？";
		next;
		select( "但他们都去哪儿了？" );
		enablenpc instance_npcname("Niren#dms101");
		enablenpc instance_npcname("Temple Guard#dms751");
		enablenpc instance_npcname("Temple Guard#dms761");
		enablenpc instance_npcname("Temple Guard#dms771");
		npctalk "这是怎么回事？", instance_npcname("Niren#dms101");
		cutin "ra_gwoman.bmp",0;
		mes "[Niren]";
		mes "什么，有什么大惊小怪的？";
		mes "冒险家...？冒险家你为什么在这里？";
		next;
		select( "这是什么..." );
		mes "[Niren]";
		mes "您一直在追踪一位行为可疑的同事，结果发现他们实际上是内奸。";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "你和我父亲是同一级别的。？";
		next;
		cutin "ra_gwoman.bmp",0;
		mes "[Niren]";
		mes "大祭司？？这到底意味着什么？";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "我认为我的父亲参与了这件事。";
		next;
		cutin "ra_gwoman.bmp",0;
		mes "[Niren]";
		mes "怎么会是……大祭司……？我们必须调查一下。";
		mes "我确信外面的人群中潜伏着一些煽动者，是坏人安插的……";
		next;
		select( "也是圣殿守卫之中的一员。" );
		mes "[Niren]";
		mes "我们需要进行一次大修……首先我们需要弄清楚我们在这里做了什么，确保没有任何危险，也没有任何损失……即使是在圣殿守卫中。";
		next;
		mes "[Niren]";
		mes "...!!";
		mes "不用调查，尤弥尔的心脏碎片已经失踪了。它应该在那里。";
		next;
		select( "我知道..." );
		mes "[Niren]";
		mes "他们到底要拿它做什么……我什至无法想象。";
		mes "这不是我们应该做的，我们需要说出真相并追查他们......!!";
		next;
		mes "[Niren]";
		mes "啊...！你说过圣殿守卫中会有敌人，所以我们必须先挑选出我们信任的人。";
		next;
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "我去吧。那可能是我父亲的，因为我很清楚它可能去了哪里。";
		next;
		cutin "ra_gwoman.bmp",0;
		mes "[Niren]";
		mes "当我们出去时我们会讨论这个，因为外面看起来不太好。";
		close2;
		cutin "",255;
		if ('nyr_main_step == 15) {
			'nyr_main_step = 16;
			disablenpc instance_npcname("Niren#dms101");
			disablenpc instance_npcname("Temple Guard#dms751");
			disablenpc instance_npcname("Temple Guard#dms761");
			disablenpc instance_npcname("Temple Guard#dms771");
			disablenpc instance_npcname("Miriam#dms701");

			enablenpc instance_npcname("#mstep09");
			enablenpc instance_npcname("#mstep10");
			enablenpc instance_npcname("#mstep11");
			enablenpc instance_npcname("Miriam#dms801");
			enablenpc instance_npcname("#dmswch02");

			enablenpc instance_npcname("Miriam#dms801");

			enablenpc instance_npcname("Temple Guard#dms801");
			enablenpc instance_npcname("Temple Guard#dms811");
			enablenpc instance_npcname("Temple Guard#dms821");
			enablenpc instance_npcname("Temple Guard#dms831");
			enablenpc instance_npcname("Temple Guard#dms841");
			enablenpc instance_npcname("Temple Guard#dms851");
			enablenpc instance_npcname("Temple Guard#dms861");
			enablenpc instance_npcname("Temple Guard#dms871");
			enablenpc instance_npcname("Temple Guard#dms881");
			enablenpc instance_npcname("Temple Guard#dms891");
			enablenpc instance_npcname("Angry Crowd#dms211");
			enablenpc instance_npcname("Angry Crowd#dms221");
			enablenpc instance_npcname("Angry Crowd#dms231");
			enablenpc instance_npcname("Angry Crowd#dms241");
			enablenpc instance_npcname("Angry Crowd#dms251");
			enablenpc instance_npcname("Angry Crowd#dms261");
			enablenpc instance_npcname("Angry Crowd#dms271");
			enablenpc instance_npcname("Angry Crowd#dms281");
			enablenpc instance_npcname("Angry Crowd#dms291");

			enablenpc instance_npcname("Angry Crowd#dms202");
			enablenpc instance_npcname("Angry Crowd#dms212");
			enablenpc instance_npcname("Angry Crowd#dms222");
			enablenpc instance_npcname("Angry Crowd#dms232");
			enablenpc instance_npcname("Angry Crowd#dms242");

			enablenpc instance_npcname("Temple Guard#dms802");
			enablenpc instance_npcname("Temple Guard#dms812");
			enablenpc instance_npcname("Temple Guard#dms822");
			enablenpc instance_npcname("Temple Guard#dms832");
			enablenpc instance_npcname("Temple Guard#dms842");
		}
		navigateto("2@nyr",120,141);
		end;
	}
	end;

OnTouch:
	if ('nyr_main_step == 13)
		npctalk "大家都聚集在那里。";
	end;
}

2@nyr,120,206,3	duplicate(dummy_npc)	Lamacus#dms601	EP18_ARMED_VILLAGER01
2@nyr,119,207,3	duplicate(dummy_npc)	Kun#dms611	EP18_ARMED_VILLAGER02
2@nyr,111,207,5	duplicate(dummy_npc)	Yopi#dms621	EP18_ARMED_VILLAGER03
2@nyr,115,204,5	duplicate(dummy_npc)	Schulang#dms301	4_EP18_SHULANG
2@nyr,117,205,3	duplicate(dummy_npc)	Bagot#dms201	4_EP18_BAGOT

2@nyr,112,201,5	duplicate(dummy_npc)	Temple Guard#dms721	4_M_RASWORD
2@nyr,121,203,3	duplicate(dummy_npc)	Temple Guard#dms731	4_M_RASWORD
2@nyr,121,201,3	duplicate(dummy_npc)	Temple Guard#dms741	4_M_RASWORD

2@nyr,115,202,5	duplicate(dummy_npc)	High Priest#dms201	4_M_RACHOLD

2@nyr,113,203,5	duplicate(dummy_npc)	Temple Guard#dms701	4_M_RASWORD
2@nyr,118,203,3	duplicate(dummy_npc)	Temple Guard#dms711	4_M_RASWORD
2@nyr,120,202,3	duplicate(dummy_npc)	Temple Guard#dms751	4_M_RASWORD
2@nyr,114,203,5	duplicate(dummy_npc)	Temple Guard#dms761	4_M_RASWORD
2@nyr,115,199,7	duplicate(dummy_npc)	Temple Guard#dms771	4_M_RASWORD
2@nyr,117,204,3	duplicate(dummy_npc)	Niren#dms101	4_F_MADAME



2@nyr,1,1,0	script	nyr_step_7	-1,{
	end;
OnStart:
	disablenpc instance_npcname("#mstep07");
	disablenpc instance_npcname("#mstep08");
	disablenpc instance_npcname("Miriam#dms701");
	disablenpc instance_npcname("Lamacus#dms601");
	disablenpc instance_npcname("Kun#dms611");
	disablenpc instance_npcname("Yopi#dms621");
	disablenpc instance_npcname("Temple Guard#dms701");
	disablenpc instance_npcname("Temple Guard#dms711");
	disablenpc instance_npcname("Temple Guard#dms721");
	disablenpc instance_npcname("Temple Guard#dms731");
	disablenpc instance_npcname("Temple Guard#dms741");
	sleep 500;
	.@label$ = instance_npcname("nyr_step_7") + "::OnMobDead";
	monster 'map_2nyr$,120,206,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_2nyr$,119,207,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_2nyr$,111,207,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_2nyr$,113,203,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,118,203,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,112,201,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,121,203,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	monster 'map_2nyr$,121,201,"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
	end;
OnMobDead:
	if ('nyr_main_step != 14)
		end;
	if (mobcount('map_2nyr$, instance_npcname("nyr_step_7") + "::OnMobDead") < 1) {
		'nyr_main_step = 15;
		enablenpc instance_npcname("Miriam#dms701");
	}
	end;
}


//------------------------------------------------------------
// Step 9
//------------------------------------------------------------
1@nyr,65,169,0	script	#dmswch02	HIDDEN_WARP_NPC,3,3,{
	end;
OnTouch:
	if ('nyr_main_step == 17) {
		navigateto("1@nyr",129,165);
		end;
	}
	if ('nyr_main_step != 16)
		end;
	'nyr_main_step = 17;
	donpcevent instance_npcname("Miriam#dms801") + "::OnMove1";
	navigateto("1@nyr",129,165);
	mapannounce 'map_2nyr$, "We're alive! Please notice us!", bc_map, 0xFFCC;
	npctalk "我认为这不是一个好情况。我需要靠近一点。", instance_npcname("米里亚姆#dms801");
	sleep 2000;
	npctalk "这边走。", instance_npcname("米里亚姆#dms801");
	mapannounce 'map_2nyr$, "We're alive! We're alive!!", bc_map, 0xFFCC;
	sleep 3000;
	mapannounce 'map_2nyr$, "We exist!! Exist!!", bc_map, 0xFFCC;
	sleep 5000;
	mapannounce 'map_2nyr$, "Give the right back to the owner of this land! Give it back!!", bc_map, 0xFFCC;
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms201");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms211");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms221");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms231");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms241");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms251");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms261");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms271");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms281");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms291");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms202");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms212");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms222");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms232");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms242");
	sleep 5000;
	mapannounce 'map_2nyr$, "We too are alive! Alive!", bc_map, 0xFFCC;
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms201");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms211");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms221");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms231");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms241");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms251");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms261");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms271");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms281");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms291");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms202");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms212");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms222");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms232");
	npctalk "我们还活着！", instance_npcname("愤怒的人群#dms242");
	sleep 5000;
	mapannounce 'map_2nyr$, "We too are exist! Exist!!", bc_map, 0xFFCC;
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms201");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms211");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms221");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms231");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms241");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms251");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms261");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms271");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms281");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms291");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms202");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms212");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms222");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms232");
	npctalk "我们存在！", instance_npcname("愤怒的人群#dms242");
	sleep 5000;
	mapannounce 'map_2nyr$, "Give this land back to its rightful owner! Give it back!!", bc_map, 0xFFCC;
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms201");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms211");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms221");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms231");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms241");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms251");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms261");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms271");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms281");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms291");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms202");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms212");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms222");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms232");
	npctalk "把它还给我！", instance_npcname("愤怒的人群#dms242");
	end;
}

1@nyr,68,163,5	script	Miriam#dms801	EP18_NPC_MIRIAM,{
	if (is_party_leader() == false) {
		npctalk "党的领导还没来吗？";
		end;
	}
	if ('nyr_main_step == 18) {
		mes "[人群]";
		mes "认可我们！";
		next;
		mes "[人群]";
		mes "我们还活着！我们在这里！！";
		next;
		mes "[人群]";
		mes "这是我们的土地！";
		next;
		mes "[人群]";
		mes "将土地归还给土地的合法所有者！";
		next;
		mes "[圣殿守卫]";
		mes "如果你现在离开，我们不会收取你侵入寺庙的罪名！";
		next;
		mes "[圣殿守卫]";
		mes "我只给你30分钟！在规定的时间内回去吧！";
		next;
		mes "[人群]";
		mes "你现在是在威胁我们吗？";
		next;
		mes "[人群]";
		mes "你会怎样做？";
		next;
		mes "[人群]";
		mes "你要逮捕所有人并将他们关进监狱，对吗？";
		next;
		mes "[人群]";
		mes "这个时候，我们就先进去吧！！！";
		next;
		cutin "ep18_miriam_03.png",1;
		mes "[米丽亚姆]";
		mes "有什么不对劲。人们变得过于激进。";
		next;
		mes "[米丽亚姆]";
		mes "这看起来不太好。我需要去找苏阿德，但是副手在哪里？";
		npctalk "快来人找苏阿德吧，事情很紧急！", instance_npcname("米里亚姆#dms801");
		next;
		enablenpc instance_npcname("Niren#dms201");
		enablenpc instance_npcname("Zhed#dms101");
		cutin "ra_gwoman.bmp",2;
		mes "[Niren]";
		mes "你就在那里。我带了哲德牧师一起来。";
		next;
		cutin "ra_gman2.bmp",2;
		mes "[哲德]";
		mes "这是怎么回事？难道和这里的人蜂拥而至有关系吗？或者说，是寺庙内有什么东西导致了这一切……";
		next;
		if ('nyr_main_step == 18) {
			'nyr_main_step = 19;
			disablenpc instance_npcname("#mstep09");
			disablenpc instance_npcname("#mstep10");
			disablenpc instance_npcname("#mstep11");
			disablenpc instance_npcname("#dmswch02");
			enablenpc instance_npcname("Suad#dms102");
			npctalk "这是怎么回事？你说你是这么着急才找到的？", instance_npcname("苏阿德#dms102");
		}
		cutin "ep18_suad_04.png",0;
		mes "[苏阿德]";
		mes "这是怎么回事？你说有急事。";
		npctalk "这是怎么回事？你说有急事。", instance_npcname("苏阿德#dms102");
		close3;
	}
	if ('nyr_main_step == 21) {
		'nyr_main_step = 22;
		enablenpc instance_npcname("#dmwrp02");
		navigateto("1@nyr",45,28);
		npctalk "冒险家，请注意安全。", instance_npcname("米里亚姆#dms801");
		cutin "ep18_miriam_03.png",2;
		mes "[米丽亚姆]";
		mes "一旦你覆盖了它，就快速行动。他们在安全屋等你。";
		disablenpc instance_npcname("Miriam#dms801");
		close3;
	}
	end;

OnMove1:
	unitwalk getnpcid(0),90,153, instance_npcname("Miriam#dms801") + "::OnMove2";
	end;
OnMove2:
	unitwalk getnpcid(0),107,165, instance_npcname("Miriam#dms801") + "::OnMove3";
	end;
OnMove3:
	unitwalk getnpcid(0),128,165, instance_npcname("Miriam#dms801") + "::OnMove4";
	end;
OnMove4:
	'nyr_main_step = 18;
	end;
}


//------------------------------------------------------------
// Step 10
//------------------------------------------------------------
1@nyr,127,163,5	script	Suad#dms102	4_EP18_SUAD,{
	if (is_party_leader() == false) {
		npctalk "希望领导能以代表的身份告诉我。";
		end;
	}
	if ('nyr_main_step != 19)
		end;
	cutin "ep18_suad_04.png",0;
	mes "[苏阿德]";
	mes "这是怎么回事？";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米丽亚姆]";
	mes "我们中间有一个内奸。";
	next;
	cutin "ep18_suad_04.png",0;
	mes "[苏阿德]";
	mes "一颗痣？在哪里？";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米丽亚姆]";
	mes "Suad首先给我们介绍一下这里的情况。听起来我们正处于骚乱的边缘，是吗？哦，你好，哲德牧师。";
	next;
	cutin "ep18_suad_02.png",0;
	mes "[苏阿德]";
	mes "为什么大祭司会在这里？";
	next;
	cutin "ra_gman2.bmp",2;
	mes "[哲德]";
	mes "米丽亚姆？米里亚姆与这件事有什么关系吗？";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米丽亚姆]";
	mes "这是有原因的，但首先我们来谈谈情况，Suad？";
	next;
	cutin "ep18_suad_03.png",0;
	mes "[苏阿德]";
	mes "这不好。它正在失控。圣殿正在向我们猛烈地倒塌。他们建议我们解散。我们的时间不多了。我们正准备撤离。";
	next;
	cutin "ep18_suad_01.png",0;
	mes "[苏阿德]";
	mes "你关注的人后来怎么样了？";
	next;
	select( "让我解释一下。" );
	cutin "",255;
	mes "- 寺庙内发生的事件。 -";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米丽亚姆]";
	mes "我的父亲和外国势力密谋分裂阿鲁纳费尔茨并压迫当地人......";
	next;
	cutin "ep18_suad_04.png",0;
	mes "[苏阿德]";
	mes "我们中间有一个内奸……但冒名顶替者是谁？";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米丽亚姆]";
	mes "与其说他们是叛徒，不如说他们躲藏起来更准确。他们从一开始就不站在我们这边。";
	next;
	cutin "ep18_suad_02.png",0;
	mes "[苏阿德]";
	mes "那么我们从一开始就几乎陷入了一场有组织的骚乱之中？";
	next;
	cutin "ra_gwoman.bmp",2;
	mes "[Niren]";
	mes "现在还不是时候。他们也渗透进了圣殿，所以我们必须两面夹击。";
	next;
	mapannounce 'map_2nyr$, "Pii-", bc_map, 0xFF0000;
	cutin "ep18_suad_04.png",0;
	mes "[苏阿德]";
	mes "那口哨声是什么？这不是我们的信号。";
	next;
	setnpcdisplay( instance_npcname("Temple Guard#dms802"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Temple Guard#dms812"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Temple Guard#dms822"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Temple Guard#dms832"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Temple Guard#dms842"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Angry Crowd#dms202"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Angry Crowd#dms212"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Angry Crowd#dms222"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Angry Crowd#dms232"), 21308 );	// EP18_MD_HEARTHUNTER_A
	setnpcdisplay( instance_npcname("Angry Crowd#dms242"), 21308 );	// EP18_MD_HEARTHUNTER_A
	npctalk "现在是吗？", instance_npcname("愤怒的人群#dms202");
	npctalk "现在！", instance_npcname("圣殿守卫#dms832");
	cutin "",255;
	mes "[人群]";
	mes "为什么要脱衣服？？";
	next;
	disablenpc instance_npcname("Temple Guard#dms812");
	disablenpc instance_npcname("Temple Guard#dms832");
	disablenpc instance_npcname("Temple Guard#dms842");
	disablenpc instance_npcname("Angry Crowd#dms202");
	disablenpc instance_npcname("Angry Crowd#dms212");
	disablenpc instance_npcname("Angry Crowd#dms222");
	disablenpc instance_npcname("Angry Crowd#dms232");
	disablenpc instance_npcname("Angry Crowd#dms242");
	enablenpc instance_npcname("Heart Hunter#dms101");
	enablenpc instance_npcname("Heart Hunter#dms111");
	enablenpc instance_npcname("Heart Hunter#dms141");
	enablenpc instance_npcname("Heart Hunter#dms161");
	enablenpc instance_npcname("Heart Hunter#dms171");
	enablenpc instance_npcname("Heart Hunter#dms181");
	enablenpc instance_npcname("Heart Hunter#dms191");
	mes "[圣殿守卫]";
	mes "保持警惕！";
	next;
	mes "[人群]";
	mes "你到底在做什么？";
	next;
	npctalk "对不起。没什么个人的。", instance_npcname("心脏猎手#dms101");
	npctalk "我还是不明白。这是怎么回事？", instance_npcname("心脏猎手#dms141");
	npctalk "她到底是一个什么样的女神呢？你应该相信我！", instance_npcname("心脏猎手#dms171");
	npctalk "怎么样，是不是尝到了压抑的滋味？", instance_npcname("心脏猎手#dms191");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms101");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms111");
	specialeffect EF_M02, AREA, instance_npcname("Heart Hunter#dms121");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms131");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms141");
	specialeffect EF_M02, AREA, instance_npcname("Heart Hunter#dms151");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms161");
	specialeffect EF_M02, AREA, instance_npcname("Heart Hunter#dms171");
	specialeffect EF_M02, AREA, instance_npcname("Heart Hunter#dms181");
	specialeffect EF_M03, AREA, instance_npcname("Heart Hunter#dms191");
	mes "[人群]";
	mes "啊啊！！！啊啊！！！圣殿守卫抓住了一个人！！！";
	next;
	mes "[圣殿守卫]";
	mes "这是一场骚乱！把它放下！";
	next;
	cutin "ep18_miriam_03.png",1;
	mes "[米丽亚姆]";
	mes "啊……我来晚了……！";
	next;
	cutin "ep18_suad_02.png",0;
	mes "[苏阿德]";
	mes "我们需要阻止暴力攻击者。";
	next;
	cutin "ra_gwoman.bmp",2;
	mes "[Niren]";
	mes "我会疏散人们。";
	if ('nyr_main_step == 19) {
		'nyr_main_step = 20;
		donpcevent instance_npcname("nyr_step_10") + "::OnStart";
	}
	close3;
}

1@nyr,1,1,0	script	nyr_step_10	-1,{
	end;
OnStart:
	disablenpc instance_npcname("Suad#dms102");
	disablenpc instance_npcname("Miriam#dms801");
	disablenpc instance_npcname("Niren#dms201");
	disablenpc instance_npcname("Zhed#dms101");
	disablenpc instance_npcname("Temple Guard#dms801");
	disablenpc instance_npcname("Temple Guard#dms811");
	disablenpc instance_npcname("Temple Guard#dms821");
	disablenpc instance_npcname("Temple Guard#dms831");
	disablenpc instance_npcname("Temple Guard#dms841");
	disablenpc instance_npcname("Temple Guard#dms851");
	disablenpc instance_npcname("Temple Guard#dms861");
	disablenpc instance_npcname("Temple Guard#dms871");
	disablenpc instance_npcname("Temple Guard#dms881");
	disablenpc instance_npcname("Temple Guard#dms891");

	disablenpc instance_npcname("Angry Crowd#dms201");
	disablenpc instance_npcname("Angry Crowd#dms211");
	disablenpc instance_npcname("Angry Crowd#dms221");
	disablenpc instance_npcname("Angry Crowd#dms231");
	disablenpc instance_npcname("Angry Crowd#dms241");
	disablenpc instance_npcname("Angry Crowd#dms251");
	disablenpc instance_npcname("Angry Crowd#dms261");
	disablenpc instance_npcname("Angry Crowd#dms271");
	disablenpc instance_npcname("Angry Crowd#dms281");
	disablenpc instance_npcname("Angry Crowd#dms291");

	disablenpc instance_npcname("Heart Hunter#dms101");
	disablenpc instance_npcname("Heart Hunter#dms111");
	disablenpc instance_npcname("Heart Hunter#dms121");
	disablenpc instance_npcname("Heart Hunter#dms131");
	disablenpc instance_npcname("Heart Hunter#dms141");
	disablenpc instance_npcname("Heart Hunter#dms151");
	disablenpc instance_npcname("Heart Hunter#dms161");
	disablenpc instance_npcname("Heart Hunter#dms171");
	disablenpc instance_npcname("Heart Hunter#dms181");
	disablenpc instance_npcname("Heart Hunter#dms191");
	disablenpc instance_npcname("Temple Guard#dms802");
	disablenpc instance_npcname("Temple Guard#dms822");
	.@label$ = instance_npcname("nyr_step_10") + "::OnMobDead";
	monster 'map_1nyr$,123,168,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,118,168,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,113,165,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,114,171,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,128,170,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,115,176,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,120,174,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,125,175,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,126,177,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	monster 'map_1nyr$,128,172,"Heart Hunter",21308,1, .@label$;	// EP18_MD_HEARTHUNTER_A
	end;
OnMobDead:
	if ('nyr_main_step != 20)
		end;
	if (mobcount('map_1nyr$, instance_npcname("nyr_step_10") + "::OnMobDead") < 1) {
		'nyr_main_step = 21;
		npctalk "冒险家，你安全吗？", instance_npcname("米里亚姆#dms801");
		enablenpc instance_npcname("Miriam#dms801");
	}
	end;
}

1@nyr,113,172,5	duplicate(dummy_npc)	Temple Guard#dms802	4_M_RASWORD
1@nyr,126,172,3	duplicate(dummy_npc)	Temple Guard#dms812	4_M_RASWORD
1@nyr,112,178,5	duplicate(dummy_npc)	Temple Guard#dms822	4_M_RASWORD
1@nyr,127,178,3	duplicate(dummy_npc)	Temple Guard#dms832	4_M_RASWORD
1@nyr,118,172,5	duplicate(dummy_npc)	Temple Guard#dms842	4_M_RASWORD
1@nyr,130,163,1	duplicate(dummy_npc)	Niren#dms201	4_F_MADAME
1@nyr,131,165,3	duplicate(dummy_npc)	Zhed#dms101	4_M_RACHOLD1

1@nyr,130,172,3	duplicate(dummy_npc)	Temple Guard#dms801	4_M_RASWORD
1@nyr,127,174,3	duplicate(dummy_npc)	Temple Guard#dms811	4_M_RASWORD
1@nyr,112,174,5	duplicate(dummy_npc)	Temple Guard#dms821	4_M_RASWORD
1@nyr,109,172,5	duplicate(dummy_npc)	Temple Guard#dms831	4_M_RASWORD
1@nyr,116,172,5	duplicate(dummy_npc)	Temple Guard#dms841	4_M_RASWORD
1@nyr,120,172,3	duplicate(dummy_npc)	Temple Guard#dms851	4_M_RASWORD
1@nyr,123,172,3	duplicate(dummy_npc)	Temple Guard#dms861	4_M_RASWORD
1@nyr,117,176,5	duplicate(dummy_npc)	Temple Guard#dms871	4_M_RASWORD
1@nyr,122,176,3	duplicate(dummy_npc)	Temple Guard#dms881	4_M_RASWORD
1@nyr,119,178,5	duplicate(dummy_npc)	Temple Guard#dms891	4_M_RASWORD

1@nyr,123,168,3	duplicate(dummy_npc)	Heart Hunter#dms101	EP18_MD_HEARTHUNTER_A
1@nyr,118,168,5	duplicate(dummy_npc)	Heart Hunter#dms111	EP18_MD_HEARTHUNTER_A
1@nyr,113,165,5	duplicate(dummy_npc)	Heart Hunter#dms121	EP18_MD_HEARTHUNTER_A
1@nyr,114,171,5	duplicate(dummy_npc)	Heart Hunter#dms131	EP18_MD_HEARTHUNTER_A
1@nyr,128,170,3	duplicate(dummy_npc)	Heart Hunter#dms141	EP18_MD_HEARTHUNTER_A
1@nyr,115,176,5	duplicate(dummy_npc)	Heart Hunter#dms151	EP18_MD_HEARTHUNTER_A
1@nyr,120,174,3	duplicate(dummy_npc)	Heart Hunter#dms161	EP18_MD_HEARTHUNTER_A
1@nyr,125,175,3	duplicate(dummy_npc)	Heart Hunter#dms171	EP18_MD_HEARTHUNTER_A
1@nyr,123,177,3	duplicate(dummy_npc)	Heart Hunter#dms181	EP18_MD_HEARTHUNTER_A
1@nyr,128,172,3	duplicate(dummy_npc)	Heart Hunter#dms191	EP18_MD_HEARTHUNTER_A

// Note: dms201 and dms231 on the same cells on official
1@nyr,109,167,7	duplicate(dummy_npc)	Angry Crowd#dms201	4_EP18_GW_MAN01
1@nyr,117,164,1	duplicate(dummy_npc)	Angry Crowd#dms211	4_EP18_GW_WOMAN01
1@nyr,109,167,7	duplicate(dummy_npc)	Angry Crowd#dms231	4_M_MIDDLE
1@nyr,112,166,1	duplicate(dummy_npc)	Angry Crowd#dms221	4_EP18_GW_MAN02
1@nyr,122,166,1	duplicate(dummy_npc)	Angry Crowd#dms241	4_EP18_GW_WOMAN02
1@nyr,115,166,7	duplicate(dummy_npc)	Angry Crowd#dms251	4_EP18_GW_MIDDLE01
1@nyr,120,167,1	duplicate(dummy_npc)	Angry Crowd#dms261	4_M_RACHMAN1
1@nyr,116,170,1	duplicate(dummy_npc)	Angry Crowd#dms271	4_EP18_GW_MIDDLE02
1@nyr,112,168,1	duplicate(dummy_npc)	Angry Crowd#dms281	4_F_SHABBY
1@nyr,124,171,1	duplicate(dummy_npc)	Angry Crowd#dms291	4_EP18_GW_WOMAN01

1@nyr,118,171,1	duplicate(dummy_npc)	Angry Crowd#dms202	4_M_RACHMAN2
1@nyr,127,166,7	duplicate(dummy_npc)	Angry Crowd#dms212	4_M_DESERT
1@nyr,125,168,7	duplicate(dummy_npc)	Angry Crowd#dms222	4_M_RACHMAN1
1@nyr,123,164,7	duplicate(dummy_npc)	Angry Crowd#dms232	4_M_MIDDLE1
1@nyr,127,169,7	duplicate(dummy_npc)	Angry Crowd#dms242	4_F_SHABBY




//-------------------------------------------------------------------------
// Daily quest
//-------------------------------------------------------------------------
1@nyr,153,145,0	warp	#qwpto01	1,7,1@nyr,146,145
1@nyr,91,33,0	warp	#qwpto03	1,7,1@nyr,86,33
1@nyr,120,181,0	script	#qwpto02	WARPNPC,7,1,{
	end;
OnTouch:
	if ('nyr_daily_step > 12 && isbegin_quest(17522) == 1)
		changequest 17522,17524;
	warp 'map_2nyr$,35,222;
	end;
}
1@nyr,88,146,0	warp	#areaw03	1,5,1@nyr,94,158
// 1@nyr,43,26,0	duplicate(dummy_npc)	#qwptora	WARPNPC,7,1	// unknown

// probably starter npcs
// 1@nyr,194,30,0	script	#mson101	HIDDEN_WARP_NPC,5,5
1@nyr,196,30,0	script	#qar101sw	HIDDEN_WARP_NPC,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 0)
		end;
	'nyr_daily_step = 1;
	disablenpc instance_npcname("#qar101sw");

	enablenpc instance_npcname("Temple Guard#qdms101");
	enablenpc instance_npcname("Temple Guard#qdms111");
	enablenpc instance_npcname("Temple Guard#qdms121");
	enablenpc instance_npcname("Temple Guard#qdms131");
	enablenpc instance_npcname("Temple Guard#qdms141");
	enablenpc instance_npcname("Temple Guard#qdms151");
	enablenpc instance_npcname("Temple Guard#qdms161");
	enablenpc instance_npcname("Temple Guard#qdms171");
	enablenpc instance_npcname("Temple Guard#qdms181");

	sleep 1000;	// (player can walk)
	npctalk "冒险家，欢迎。感谢您加入我们这次清洁行动。", instance_npcname("圣殿守卫#qdms101");
	sleep 1500;
	npctalk "大家都集合了吗？", instance_npcname("圣殿守卫#qdms101");
	sleep 1000;
	npctalk "是的，先生！", instance_npcname("圣殿守卫#qdms111");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#qdms121");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#qdms131");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#qdms141");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#qdms151");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#qdms161");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#qdms171");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#qdms181");
	sleep 1000;
	npctalk "那些放弃侍奉女神的生活、违背誓言的叛徒正在扰乱这里！", instance_npcname("圣殿守卫#qdms101");
	sleep 1500;
	npctalk "将女神的意志落实到他们身上也是我们的责任！", instance_npcname("圣殿守卫#qdms101");
	sleep 1500;
	npctalk "从现在开始，我们封锁了四个区域：三个花园区和一个寺庙入口。让我们依次净化它们。", instance_npcname("圣殿守卫#qdms101");
	sleep 1500;
	npctalk "当心，在黑暗中可能无法区分盟友和敌人！请务必小心，避免攻击我们自己的人！", instance_npcname("圣殿守卫#qdms101");
	enablenpc instance_npcname("Temple Guard#qdms01");
	sleep 1500;
	npctalk "到各自的岗位！", instance_npcname("圣殿守卫#qdms101");

	disablenpc instance_npcname("Temple Guard#qdms101");
	disablenpc instance_npcname("Temple Guard#qdms111");
	disablenpc instance_npcname("Temple Guard#qdms121");
	disablenpc instance_npcname("Temple Guard#qdms131");
	disablenpc instance_npcname("Temple Guard#qdms141");
	disablenpc instance_npcname("Temple Guard#qdms151");
	disablenpc instance_npcname("Temple Guard#qdms161");
	disablenpc instance_npcname("Temple Guard#qdms171");
	disablenpc instance_npcname("Temple Guard#qdms181");
	end;
}

// Guards entrance daily
1@nyr,190,31,1	duplicate(dummy_npc)	Temple Guard#qdms101	4_M_RASWORD
1@nyr,186,31,5	duplicate(dummy_npc)	Temple Guard#qdms111	4_M_RASWORD
1@nyr,187,32,5	duplicate(dummy_npc)	Temple Guard#qdms121	4_M_RASWORD
1@nyr,188,33,5	duplicate(dummy_npc)	Temple Guard#qdms131	4_M_RASWORD
1@nyr,189,34,5	duplicate(dummy_npc)	Temple Guard#qdms141	4_M_RASWORD
1@nyr,185,32,5	duplicate(dummy_npc)	Temple Guard#qdms151	4_M_RASWORD
1@nyr,186,33,5	duplicate(dummy_npc)	Temple Guard#qdms161	4_M_RASWORD
1@nyr,187,34,5	duplicate(dummy_npc)	Temple Guard#qdms171	4_M_RASWORD
1@nyr,188,35,5	duplicate(dummy_npc)	Temple Guard#qdms181	4_M_RASWORD


// 1@nyr,120,173,0	duplicate(dummy_npc)	#qar201sw	HIDDEN_WARP_NPC,5,5
// 1@nyr,108,167,0	duplicate(dummy_npc)	#qmobg401	HIDDEN_WARP_NPC,5,5

// 1@nyr,165,32,0	duplicate(dummy_npc)	#qmobg101	HIDDEN_WARP_NPC,5,5
1@nyr,1,1,0	script	#qmobg101	-1,{
	end;
OnStart01:
	callsub( S_Call, 1, "No one can stop us!", "Temple Guard#qdms01", 165,45, 168,47, 170,58 );	// basic routine to spawn the monsters
OnMobDead1:
	callsub( S_Next, 2, "There are still enemies remaining in Zone 1! Search and destroy!", "Temple Guard#qdms02" );	// basic routine to enable the next npcs

OnStart02:
	callsub( S_Call, 2, "We have grown stronger now!", "Temple Guard#qdms02", 159,114, 162,114, 186,122 );
OnMobDead2:
	callsub( S_Next, 3, "Zone 1 still harbors foes! Search and eliminate them!", "Temple Guard#qdms03" );

OnStart03:
	callsub( S_Call, 3, "They're driving us like prey!! Unacceptable!", "Temple Guard#qdms03", 165,141, 164,132, 165,136, 165,127 );
OnMobDead3:
	callsub( S_Next, 4, "Zone 1 cleared! Everyone, move to Zone 2!", "Temple Guard#qdms21", "#qwpto01" );

OnStart21:
	callsub( S_Call, 4, "Do you know what's in my heart?", "Temple Guard#qdms21", 137,124 );
OnMobDead4:
	callsub( S_Next, 5, "Enemies still remain in Zone 2! Search and destroy!", "Temple Guard#qdms22" );

OnStart22:
	callsub(S_Call, 5, "We must avoid them quickly!", "Temple Guard#qdms22", 114,111, 102,98, 108,78, 120,78, 126,110 );
OnMobDead5:
	callsub( S_Next, 6, "Enemies still remain in Zone 2! Search and destroy!", "Temple Guard#qdms23" );

OnStart23:
	callsub( S_Call, 6, "Do you think I'll just stand by and take it?", "Temple Guard#qdms23", 138,61, 130,47, 123,35, 105,47, 103,35 );
OnMobDead6:
	callsub( S_Next, 7, "Zone 2 cleared! Everyone, move to Zone 3!", "Temple Guard#qdms31", "#qwpto03" );

OnStart31:
	callsub( S_Call, 7, "What did we do wrong??", "Temple Guard#qdms31", 74,39, 59,31, 54,47 );
OnMobDead7:
	callsub( S_Next, 8, "Enemies still remain in Zone 3! Search and destroy!", "Temple Guard#qdms32" );

OnStart32:
	callsub( S_Call, 8, "We must avoid them quickly!", "Temple Guard#qdms32", 63,61, 54,76, 77,100 );
OnMobDead8:
	callsub( S_Next, 9, "Enemies still remain in Zone 3! Search and destroy!", "Temple Guard#qdms33" );

OnStart33:
	callsub( S_Call, 9, "Eek!!", "Temple Guard#qdms33", 55,111, 74,120, 54,127, 80,140, 64,141 );
OnMobDead9:
	callsub( S_Next, 10, "Zone 3 cleared! Everyone, move to Zone 4!", "Temple Guard#qdms41", "#areaw03" );

OnStart41:
	callsub( S_Call, 10, "You guys are really tough.", "Temple Guard#qdms41", 94,185, 79,180, 62,183, 68,199 );
OnMobDead10:
	callsub( S_Next, 11, "Enemies still remain in Zone 4! Search and destroy!", "Temple Guard#qdms42" );

OnStart42:
	callsub( S_Call, 11, "We must avoid them quickly!", "Temple Guard#qdms42", 119,168, 146,183, 177,182 );
OnMobDead11:
	if ('nyr_daily_step != 12)
		end;
	if (mobcount('map_1nyr$, instance_npcname("#qmobg101") + "::OnMobDead11") > 0)
		end;
	mapannounce 'map_1nyr$, "All zones cleared! Gather at the entrance of the temple!", bc_map, 0xFFCC;
	for ( .@i = 0; .@i < 9; ++.@i )
		enablenpc instance_npcname("Temple Guard#qdms1" + .@i + "2");
	end;

S_Next:	// basic routine to mapannounce and enable the npcs
	if ('nyr_daily_step != getarg(0))
		end;
	if (mobcount('map_1nyr$, instance_npcname("#qmobg101") + "::OnMobDead" + ('nyr_daily_step-1)) > 0)
		end;
	mapannounce 'map_1nyr$, getarg(1), bc_map, 0xFFCC;
	for ( .@i = 2; .@i < getargcount(); ++.@i )
		enablenpc instance_npcname( getarg(.@i) );
	end;

S_Call:	// basic routine to display the message and spawn the monsters
	.@num = getarg(0);
	if ('nyr_daily_step != .@num)
		end;
	'nyr_daily_step = .@num + 1;
	npctalk getarg(1), instance_npcname( getarg(2) );
	sleep 500;
	disablenpc instance_npcname( getarg(2) );
	getmapxy .@map$, .@x, .@y, BL_NPC, getarg(2);
	.@label$ = instance_npcname("#qmobg101") + "::OnMobDead" + .@num;
	areamonster 'map_1nyr$, .@x-2, .@y-2, .@x+2, .@y+2, "Renegade Guard",21311,1, .@label$;	// EP18_MD_GUARD_B
	for ( .@i = 3; .@i < getargcount(); .@i += 2 ) {
		if (rand(2))
			monster 'map_1nyr$, getarg(.@i), getarg(.@i+1),"Temple Guard",21310,1, .@label$;	// EP18_MD_GUARD_A
		else
			monster 'map_1nyr$, getarg(.@i), getarg(.@i+1),"Renegade Guard",21311,1, .@label$;	// EP18_MD_GUARD_B
	}
	end;
}

1@nyr,165,32,5	script	Temple Guard#qdms01	4_M_RASWORD,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	.@string$ = replacestr( strnpcinfo(2), "qdms", "" );
	donpcevent instance_npcname("#qmobg101") + "::OnStart" + .@string$;
	end;
}
1@nyr,165,98,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms02	4_M_RASWORD,5,5
1@nyr,184,141,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms03	4_M_RASWORD,5,5
1@nyr,139,134,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms21	4_M_RASWORD,5,5
1@nyr,102,109,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms22	4_M_RASWORD,5,5
1@nyr,137,78,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms23	4_M_RASWORD,5,5
1@nyr,74,32,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms31	4_M_RASWORD,5,5
1@nyr,54,61,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms32	4_M_RASWORD,5,5
1@nyr,65,108,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms33	4_M_RASWORD,5,5
1@nyr,108,167,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms41	4_M_RASWORD,5,5
1@nyr,107,178,5	duplicate(Temple Guard#qdms01)	Temple Guard#qdms42	4_M_RASWORD,5,5

// Final map 1
1@nyr,119,175,3	script	Temple Guard#qdms102	4_M_RASWORD,2,2,{
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 12)
		end;
	mes "[圣殿守卫队长]";
	mes "干得好，大家！每天的清洁工作都会持续进行！今天就散了吧，好好休息吧！";
	npctalk "是的，先生！！", instance_npcname("圣殿守卫#qdms112");
	npctalk "是的，先生！！", instance_npcname("圣殿守卫#qdms122");
	npctalk "是的，先生！！", instance_npcname("圣殿守卫#qdms132");
	npctalk "是的，先生！！", instance_npcname("圣殿守卫#qdms142");
	npctalk "是的，先生！！", instance_npcname("圣殿守卫#qdms152");
	npctalk "是的，先生！！", instance_npcname("圣殿守卫#qdms162");
	npctalk "是的，先生！！", instance_npcname("圣殿守卫#qdms172");
	npctalk "是的，先生！！", instance_npcname("圣殿守卫#qdms182");
	next;
	mes "[圣殿守卫队长]";
	mes "冒险家，谢谢你的帮助。";
	next;
	mes "[圣殿守卫队长]";
	mes "我听说你也会和我们一起在寺庙内进行一次单独的清洁行动。我们就指望你了！";
	close2;
	if ('nyr_daily_step != 12)
		end;
	'nyr_daily_step = 13;
	enablenpc instance_npcname("#qwpto02");
	enablenpc instance_npcname("#2ar101sw");
	end;
}
1@nyr,116,171,7	duplicate(dummy_npc)	Temple Guard#qdms112	4_M_RASWORD
1@nyr,118,171,7	duplicate(dummy_npc)	Temple Guard#qdms122	4_M_RASWORD
1@nyr,120,171,1	duplicate(dummy_npc)	Temple Guard#qdms132	4_M_RASWORD
1@nyr,122,171,1	duplicate(dummy_npc)	Temple Guard#qdms142	4_M_RASWORD
1@nyr,116,173,7	duplicate(dummy_npc)	Temple Guard#qdms152	4_M_RASWORD
1@nyr,118,173,7	duplicate(dummy_npc)	Temple Guard#qdms162	4_M_RASWORD
1@nyr,120,173,1	duplicate(dummy_npc)	Temple Guard#qdms172	4_M_RASWORD
1@nyr,122,173,1	duplicate(dummy_npc)	Temple Guard#qdms182	4_M_RASWORD

// nowalk delimiter npcs
1@nyr,89,24,5	duplicate(dummy_npc)	#cell01	2_MONEMUS
1@nyr,89,37,5	duplicate(dummy_npc)	#cell02	2_MONEMUS
1@nyr,89,58,5	duplicate(dummy_npc)	#cell03	2_MONEMUS
1@nyr,89,65,5	duplicate(dummy_npc)	#cell04	2_MONEMUS
1@nyr,89,106,5	duplicate(dummy_npc)	#cell05	2_MONEMUS
1@nyr,89,113,5	duplicate(dummy_npc)	#cell06	2_MONEMUS
1@nyr,89,134,5	duplicate(dummy_npc)	#cell07	2_MONEMUS
1@nyr,89,153,5	duplicate(dummy_npc)	#cell08	2_MONEMUS
1@nyr,150,134,5	duplicate(dummy_npc)	#cell09	2_MONEMUS
1@nyr,150,153,5	duplicate(dummy_npc)	#cell10	2_MONEMUS
1@nyr,150,24,5	duplicate(dummy_npc)	#cell11	2_MONEMUS
1@nyr,150,37,5	duplicate(dummy_npc)	#cell12	2_MONEMUS
1@nyr,150,58,5	duplicate(dummy_npc)	#cell13	2_MONEMUS
1@nyr,150,65,5	duplicate(dummy_npc)	#cell14	2_MONEMUS
1@nyr,150,106,5	duplicate(dummy_npc)	#cell15	2_MONEMUS
1@nyr,150,113,5	duplicate(dummy_npc)	#cell66	2_MONEMUS

// 1@nyr,89,153,5	duplicate(dummy_npc)	#cell41	2_MONEMUS	// duplicate of 8
1@nyr,98,153,5	duplicate(dummy_npc)	#cell42	2_MONEMUS
1@nyr,141,153,5	duplicate(dummy_npc)	#cell51	2_MONEMUS


// map 2
2@nyr,35,200,0	script	#2ar101sw	HIDDEN_WARP_NPC,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 13)
		end;
	'nyr_daily_step = 14;
	for ( .@i = 0; .@i < 7; ++.@i )
		enablenpc instance_npcname("Temple Guard#2dms1" + .@i + "1");
	npctalk "检查所有设施并确保安全。任何试图破坏并获得权力的人都必须受到处理！", instance_npcname("圣殿守卫#2dms101");
	sleep 2000;
	npctalk "是的，先生！", instance_npcname("圣殿守卫#2dms111");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#2dms121");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#2dms131");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#2dms141");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#2dms151");
	npctalk "是的，先生！", instance_npcname("圣殿守卫#2dms161");
	sleep 2000;
	npctalk "到各自的岗位！", instance_npcname("圣殿守卫#2dms101");
	sleep 2000;
	for ( .@i = 1; .@i < 7; ++.@i )
		disablenpc instance_npcname("Temple Guard#2dms1" + .@i + "1");
	npctalk "冒险家，谢谢你参与净化行动！", instance_npcname("圣殿守卫#2dms101");
	sleep 2000;
	npctalk "除了对付入侵者之外，我还有一项任务交给你。", instance_npcname("圣殿守卫#2dms101");
	sleep 2000;
	npctalk "暂时，我将授予该党领袖管理员权限。请每天根据变更的安全设施重新设置安全密码。", instance_npcname("圣殿守卫#2dms101");
	sleep 2000;
	'code = rand(1000,9999);
	npctalk "今天的安全码是" + 'code + "。设置前请确保仓库和仓库是空的！", instance_npcname("Temple Guard#2dms101");
	sleep 2000;
	npctalk "现在，让我们开始任务吧！", instance_npcname("圣殿守卫#2dms101");
	enablenpc instance_npcname("Temple Guard#2dms10");
	end;
}

2@nyr,35,187,7	script	Temple Guard#2dms101	4_M_RASWORD,{
	if ('code > 0)
		npctalk "您忘记了安全码吗？今天的安全码是" + 'code + "！匆忙！我很快就会加入你们！", instance_npcname("Temple Guard#2dms101");
	end;
}

2@nyr,37,191,3	duplicate(dummy_npc)	Temple Guard#2dms111	4_M_RASWORD
2@nyr,35,191,3	duplicate(dummy_npc)	Temple Guard#2dms121	4_M_RASWORD
2@nyr,33,191,3	duplicate(dummy_npc)	Temple Guard#2dms131	4_M_RASWORD
2@nyr,33,189,5	duplicate(dummy_npc)	Temple Guard#2dms141	4_M_RASWORD
2@nyr,35,189,5	duplicate(dummy_npc)	Temple Guard#2dms151	4_M_RASWORD
2@nyr,37,189,5	duplicate(dummy_npc)	Temple Guard#2dms161	4_M_RASWORD


// mobs spawn npcs
2@nyr,1,1,0	script	#nyr_puri_mob_2	-1,{
	end;
OnStart10:
	callsub( S_Call, 14, "Ah! What a surprise!", "Temple Guard#2dms10" );
OnMobDead14:
	callsub( S_Next, 15, "Enemies still remain in Zone 1! Search and destroy!", "Heart Hunter#2dms11" );

OnStart11:
	callsub( S_Call, 15, "What? Why them??", "Heart Hunter#2dms11" );
OnMobDead15:
	callsub( S_Next, 16, "Enemies still remain in Zone 1! Search and destroy!", "Heart Hunter#2dms12" );

OnStart12:
	callsub( S_Call, 16, "Eek!!", "Heart Hunter#2dms12" );
OnMobDead16:
	callsub( S_Next, 17, "Corridors near Storage 1 cleared! Proceed to Storage 1!", "Heart Hunter#2dms13", "#2mstep01" );

OnStart13:
	callsub( S_Call, 17, "Ugh! Annoying! Can't they just leave us alone!", "Heart Hunter#2dms13", 33,104, 31,79, 31,67, 18,81 );
OnMobDead17:
	callsub( S_Next, 18, "Storage 1 cleared! Awaiting security code reset", "#2mstep02" );

OnStart20:
	callsub( S_Call, 20, "Why is everyone so persistent!!", "Heart Hunter#2dms20" );
OnMobDead20:
	callsub( S_Next, 21, "Enemies still remain in Zone 2! Search and destroy!", "Heart Hunter#2dms21" );

OnStart21:
	callsub( S_Call, 21, "Leave us alone!", "Heart Hunter#2dms21" );
OnMobDead21:
	callsub( S_Next, 22, "Corridors near Storage 2 cleared! Proceed to Storage 2!", "Heart Hunter#2dms22", "#2mstep03" );

OnStart22:
	callsub( S_Call, 22, "If only I could find that book...! Gasp! Who are you?", "Heart Hunter#2dms22", 94,62, 132,62, 156,48, 150,40, 132,17, 100,16 , 83,33, 93,44);
OnMobDead22:
	callsub( S_Next, 23, "Storage 2 cleared! Awaiting security code reset", "#2mstep04" );

OnStart30:
	callsub( S_Call, 25, "I won't leave you alone!!", "Heart Hunter#2dms30" );
OnMobDead25:
	callsub( S_Next, 26, "Enemies still remain in Zone 3! Search and destroy!", "Heart Hunter#2dms31" );

OnStart31:
	callsub( S_Call, 26, "So persistent! I'm sick of it!", "Heart Hunter#2dms31" );
OnMobDead26:
	callsub( S_Next, 27, "Corridors near Storage 3 cleared! Proceed to Storage 3!", "Heart Hunter#2dms32", "#2mstep05" );

OnStart32:
	callsub( S_Call, 27, "We need to hurry to the warehouse! Argh!!", "Heart Hunter#2dms32", 195,99, 214,101, 198,86, 205,64, 213,52 );
OnMobDead27:
	callsub( S_Next, 28, "Storage 3 cleared! Awaiting security code reset", "#2mstep06" );

OnStart40:
	callsub( S_Call, 30, "I haven't got what I want yet!", "Heart Hunter#2dms40" );
OnMobDead30:
	callsub( S_Next, 31, "Center cleared! Proceed to the storage room!", "#2mstep07", "#2mstep08", "Heart Hunter#2dms41", "Heart Hunter#2dms42", "Heart Hunter#2dms43", "Heart Hunter#2dms44", "Heart Hunter#2dms45",
		"Heart Hunter#2dms46", "Heart Hunter#2dms47", "Heart Hunter#2dms48", "Heart Hunter#2dms49", "#2ar201sw" );

S_Next:
	if ('nyr_daily_step != getarg(0))
		end;
	if (mobcount('map_2nyr$, instance_npcname("#nyr_puri_mob_2") + "::OnMobDead" + ('nyr_daily_step-1)) > 0)
		end;
	mapannounce 'map_2nyr$, getarg(1), bc_map, 0xFFCC;
	for ( .@i = 2; .@i < getargcount(); ++.@i )
		enablenpc instance_npcname( getarg(.@i) );
	end;

S_Call:
	.@num = getarg(0);
	if ('nyr_daily_step != .@num)
		end;
	'nyr_daily_step = .@num + 1;
	npctalk getarg(1), instance_npcname( getarg(2) );
	sleep 500;
	disablenpc instance_npcname( getarg(2) );
	.@label$ = instance_npcname("#nyr_puri_mob_2") + "::OnMobDead" + .@num;
	if (getargcount() < 4) {
		getmapxy .@map$, .@x, .@y, BL_NPC, getarg(2);
		monster 'map_2nyr$, .@x, .@y,"Heart Hunter",21312,1, .@label$;	// EP18_MD_HEARTHUNTER_R
	}
	else {
		for ( .@i = 3; .@i < getargcount(); .@i += 2 ) {
			monster 'map_2nyr$, getarg(.@i), getarg(.@i+1),"Heart Hunter",21312,1, .@label$;	// EP18_MD_HEARTHUNTER_R
		}
	}
	end;

OnFinal:
	if ('nyr_daily_step != 32)
		end;
	if (mobcount('map_2nyr$, instance_npcname("#nyr_puri_mob_2") + "::OnFinal") > 0)
		end;
	mapannounce 'map_2nyr$, "Vault Security Code Reset in Progress!", bc_map, 0xFFCC;
	disablenpc instance_npcname("#2mstep07");
	disablenpc instance_npcname("#2mstep08");
	// enablenpc instance_npcname("#2mstep09");
	// enablenpc instance_npcname("#2mstep10");
	end;
}

2@nyr,35,171,5	script	Temple Guard#2dms10	EP18_MD_HEARTHUNTER_R,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	.@string$ = replacestr( strnpcinfo(2), "2dms", "" );
	donpcevent instance_npcname("#nyr_puri_mob_2") + "::OnStart" + .@string$;
	end;
}
2@nyr,36,146,5	duplicate(Temple Guard#2dms10)	Heart Hunter#2dms11	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,64,131,5	duplicate(Temple Guard#2dms10)	Heart Hunter#2dms12	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,42,104,5	duplicate(Temple Guard#2dms10)	Heart Hunter#2dms13	EP18_MD_HEARTHUNTER_R,5,5

2@nyr,69,103,5	duplicate(Temple Guard#2dms10)	Heart Hunter#2dms20	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,106,78,5	duplicate(Temple Guard#2dms10)	Heart Hunter#2dms21	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,94,62,5	duplicate(Temple Guard#2dms10)	Heart Hunter#2dms22	EP18_MD_HEARTHUNTER_R,5,5

2@nyr,129,75,5	duplicate(Temple Guard#2dms10)	Heart Hunter#2dms30	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,158,104,5	duplicate(Temple Guard#2dms10)	Heart Hunter#2dms31	EP18_MD_HEARTHUNTER_R,5,5
2@nyr,195,99,5	duplicate(Temple Guard#2dms10)	Heart Hunter#2dms32	EP18_MD_HEARTHUNTER_R,5,5

2@nyr,174,109,5	duplicate(Temple Guard#2dms10)	Heart Hunter#2dms40	EP18_MD_HEARTHUNTER_R,5,5

	
// final battle
2@nyr,115,177,3	script	Heart Hunter#2dms41	EP18_MD_HEARTHUNTER_R,5,5,{
	end;
OnTouch:
	npctalk "啊，好像有什么东西来了~", instance_npcname("心脏猎手#2dms41");
	end;
}

2@nyr,126,174,5	script	Heart Hunter#2dms42	EP18_MD_HEARTHUNTER_R,5,5,{
	end;
OnTouch:
	npctalk "惊险！！！极好的！！！", instance_npcname("心脏猎手#2dms42");
	end;
}

2@nyr,117,207,1	script	Heart Hunter#2dms43	EP18_MD_HEARTHUNTER_R,2,2,{
	end;
OnTouch:
	npctalk "我记得上次见过这个，但我们又是如何处理的......", instance_npcname("心脏猎手#2dms43");
	end;
}

2@nyr,115,206,7	script	Heart Hunter#2dms44	EP18_MD_HEARTHUNTER_R,2,2,{
	end;
OnTouch:
	npctalk "你不是这样做的。", instance_npcname("心脏猎手#2dms44");
	end;
}

2@nyr,119,206,1	script	Heart Hunter#2dms45	EP18_MD_HEARTHUNTER_R,2,2,{
	end;
OnTouch:
	npctalk "如果你做不到，就靠边站。我会处理的。", instance_npcname("心脏猎手#2dms45");
	end;
}

2@nyr,129,199,5	script	Heart Hunter#2dms46	EP18_MD_HEARTHUNTER_R,2,2,{
	end;
OnTouch:
	npctalk "哦，我恐高。", instance_npcname("心脏猎手#2dms46");
	end;
}

2@nyr,113,194,3	script	Heart Hunter#2dms47	EP18_MD_HEARTHUNTER_R,2,2,{
	end;
OnTouch:
	npctalk "这里有东西！", instance_npcname("心脏猎手#2dms47");
	end;
}

2@nyr,111,209,5	script	Heart Hunter#2dms48	EP18_MD_HEARTHUNTER_R,2,2,{
	end;
OnTouch:
	npctalk "嘿！这真是令人兴奋啊~", instance_npcname("心脏猎手#2dms48");
	end;
}

2@nyr,112,206,5	script	Heart Hunter#2dms49	EP18_MD_HEARTHUNTER_R,2,2,{
	end;
OnTouch:
	npctalk "这一切什么时候才能结束……", instance_npcname("心脏猎手#2dms49");
	end;
}

2@nyr,115,201,5	script	Heart Hunter#2dms50	EP17_1_BELLARE1,{
	npctalk "它是什么？也许只是你的心情。", instance_npcname("心脏猎手#2dms50");
	end;
}


2@nyr,118,200,0	script	#2ar201sw	HIDDEN_WARP_NPC,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 31)
		end;
	'nyr_daily_step = 32;
	disablenpc();
	enablenpc instance_npcname("Heart Hunter#2dms50");
	emotion ET_QUESTION, getnpcid(0,instance_npcname("Heart Hunter#2dms50"));
	sleep 500;
	npctalk "这是什么？不速之客？", instance_npcname("心脏猎手#2dms50");
	sleep 2000;
	npctalk "你们都在做什么，却没有注意到有人进来？快点摆脱它吧！", instance_npcname("心脏猎手#2dms50");
	sleep 2000;
	npctalk "啊~我陶醉了~陶醉在心灵的魔力之中~", instance_npcname("心脏猎手#2dms48");
	sleep 2000;
	npctalk "这不是王国唯一允许的魔法吗？", instance_npcname("心脏猎手#2dms48");
	npctalk "你在说什么？这也是王国所不允许的。你忘记了吗？", instance_npcname("心脏猎手#2dms44");
	sleep 2000;
	npctalk "哦，对了。我们这是非法侵入，不是吗？", instance_npcname("心脏猎手#2dms49");
	sleep 200;
	npctalk "也许兴奋来自于它是非法的？", instance_npcname("心脏猎手#2dms48");
	npctalk "嘿！这很奇怪。无论我如何操纵它，心的魔力都不会散发出来。", instance_npcname("心脏猎手#2dms43");
	npctalk "那就靠边站吧！让我试试吧！！", instance_npcname("心脏猎手#2dms45");
	sleep 2000;
	npctalk "什么？那么，现在流经我身体的兴奋感是什么呢？", instance_npcname("心脏猎手#2dms48");
	sleep 2000;
	npctalk "嗯，我的心情第一次感到振奋。", instance_npcname("心脏猎手#2dms48");
	npctalk "仔细检查一下。它可能会被篡改。", instance_npcname("心脏猎手#2dms49");
	npctalk "你声称以前见过操控术？你想让我们只相信你吗？", instance_npcname("心脏猎手#2dms50");
	sleep 1000;
	npctalk "那...等一下，它显示安全代码不匹配？", instance_npcname("心脏猎手#2dms43");
	sleep 2000;
	npctalk "安全码不匹配？嗯……我觉得可能和这里的冒险者有关？正确的？", instance_npcname("心脏猎手#2dms50");
	sleep 2000;
	npctalk "您可以输入更改后的安全码吗？那么我们都会真正幸福。", instance_npcname("心脏猎手#2dms50");
	sleep 2000;
	npctalk "退到一边去。有时需要敲击机器才能听！", instance_npcname("心脏猎手#2dms45");
	specialeffect EF_HITDARK, AREA, instance_npcname("Heart Hunter#2dms45");
	specialeffect EF_MAGICCRASHER, AREA, instance_npcname("Heart Hunter#2dms45");
	npctalk "嘿！是谁在这样操作机器？", instance_npcname("心脏猎手#2dms43");
	sleep 2000;
	specialeffect EF_LIGHTNINGLOADER, AREA, instance_npcname("Heart Hunter#2dms48");
	specialeffect EF_MAGICALATTHIT, AREA, instance_npcname("Heart Hunter#2dms48");
	npctalk "哎呀！！！突然就更兴奋了！！这也是因为我的心情吗？", instance_npcname("心脏猎手#2dms48");
	npctalk "看来是短路了！它正在发出光芒！", instance_npcname("心脏猎手#2dms44");
	sleep 2000;
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms48");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms48");
	npctalk "啊啊啊！！！", instance_npcname("心脏猎手#2dms48");
	npctalk "嘿！！这个太棒了！！！", instance_npcname("心脏猎手#2dms44");
	npctalk "为什么只有这样……？这里有什么奇怪的吗？", instance_npcname("心脏猎手#2dms43");
	sleep 2000;
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms43");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms44");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms45");
	npctalk "呃……？", instance_npcname("心脏猎手#2dms43");
	npctalk "这是什么？", instance_npcname("心脏猎手#2dms44");
	npctalk "不出所料，你必须打击故障机器！", instance_npcname("心脏猎手#2dms45");
	sleep 2000;
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms49");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms49");
	npctalk "我是不是也很震惊呢？我的身体也有问题吗？", instance_npcname("心脏猎手#2dms49");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms43");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms44");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms45");
	sleep 2000;
	npctalk "不是这样，我成功了。你看，我们都在心灵共鸣，不是吗？", instance_npcname("心脏猎手#2dms45");
	sleep 200;
	npctalk "啊...", instance_npcname("心脏猎手#2dms50");
	sleep 2000;
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms41");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms42");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms46");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms47");
	specialeffect EF_NPC_STOP, AREA, instance_npcname("Heart Hunter#2dms50");
	npctalk "任何。虽然我们无法提取出心灵的魔力，但我们的共鸣却运转良好。那么我们要测试一下这个力量吗？", instance_npcname("心脏猎手#2dms50");
	npctalk "幸好这里有冒险家。完美的时机。", instance_npcname("心脏猎手#2dms49");
	npctalk "好的。真是幸运啊。不然我们之间可能会吵架吧？", instance_npcname("心脏猎手#2dms45");
	npctalk "啊!我在普隆德拉看到过类似的东西。每个人都在那里打鸡蛋，对吗？", instance_npcname("心脏猎手#2dms44");
	sleep 2000;
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms41");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms42");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms46");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms47");
	specialeffect EF_UNDEADBODY, AREA, instance_npcname("Heart Hunter#2dms50");
	npctalk "这不涉及个人感情，但如果我们就这样放任不管，我们就会有麻烦。", instance_npcname("心脏猎手#2dms50");
	sleep 2000;
	npctalk "如果你只是假装不知道，直接过去就好了。哦，好吧，再见。", instance_npcname("心脏猎手#2dms50");

	for ( .@i = 41; .@i < 51; ++.@i ) {
		hideonnpc instance_npcname("Heart Hunter#2dms" + .@i );
		disablenpc instance_npcname("Heart Hunter#2dms" + .@i );
	}

	.@label$ = instance_npcname("#nyr_puri_mob_2") + "::OnFinal";
	monster 'map_2nyr$,122,194,"Resonator",21312,1, .@label$;	// EP18_MD_HEARTHUNTER_R
	monster 'map_2nyr$,118,196,"Resonator",21312,1, .@label$;
	monster 'map_2nyr$,117,207,"Resonator",21312,1, .@label$;
	monster 'map_2nyr$,115,206,"Resonator",21312,1, .@label$;
	monster 'map_2nyr$,119,206,"Resonator",21312,1, .@label$;
	monster 'map_2nyr$,113,194,"Resonator",21312,1, .@label$;
	monster 'map_2nyr$,111,209,"Resonator",21312,1, .@label$;
	monster 'map_2nyr$,112,206,"Resonator",21312,1, .@label$;
	monster 'map_2nyr$,115,201,"Resonator",21313,1, .@label$;	// EP18_MD_HEARTHUNTER_F
	end;
}


// warp npcs
2@nyr,56,104,0	warp	#2mstep01	1,1,2@nyr,49,104

2@nyr,49,55,0	script	#2mstep02	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,53,55;
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 18)
		end;
	'nyr_daily_step = 19;
	disablenpc instance_npcname("#2mstep01");
	enablenpc instance_npcname("Security Device#2dms10");
	end;
}

2@nyr,119,71,0	warp	#2mstep03	1,1,2@nyr,119,65

2@nyr,119,66,0	script	#2mstep04	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,117,73;
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 23)
		end;
	'nyr_daily_step = 24;
	disablenpc instance_npcname("#2mstep03");
	enablenpc instance_npcname("Security Device#2dms20");
	end;
}

2@nyr,183,104,0	warp	#2mstep05	1,1,2@nyr,190,104

2@nyr,186,104,0	script	#2mstep06	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,180,104;
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 28)
		end;
	'nyr_daily_step = 29;
	disablenpc instance_npcname("#2mstep05");
	enablenpc instance_npcname("Security Device#2dms30");
	end;
}

2@nyr,120,123,0	script	#2mstep07	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,120,126;
	navigateto("2@nyr",120,137);
	end;
}

2@nyr,120,137,0	script	#2mstep08	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,120,147;
	navigateto("2@nyr",120,200);
	end;
}

2@nyr,120,141,0	script	#2mstep09	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,120,134;
	navigateto("2@nyr",151,131);
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 32)
		end;
	'nyr_daily_step = 33;
	enablenpc instance_npcname("Security Device#2dms40");
	end;
}

2@nyr,151,131,0	script	#2mstep10	WARPNPC,1,1,{
	end;
OnTouch:
	warp 'map_2nyr$,159,131;
	navigateto("2@nyr",203,220);
	end;
}

2@nyr,203,220,0	script	#2mstep11	WARPNPC,1,1,{
	end;
OnTouch:
	if ('nyr_daily_step == 35 && isbegin_quest(17523) == 1)
		changequest 17523,17526;
	warp "rachel",167,240;
	end;
}


// Code
2@nyr,51,57,5	script	Security Device#2dms10	4_POINT_BLUE,5,5,{
	if (is_party_leader() == false)
		end;
	switch( atoi( replacestr( strnpcinfo(2), "2dms", "" ) ) ) {
	case 10:
		.@step = 19;
		.@mes$ = "存储 1 的安全代码已重置。";
		.@enable$ = "Heart Hunter#2dms20";
		setarray .@xy[0],119,73;
		break;
	case 20:
		.@step = 24;
		.@mes$ = "存储 2 的安全代码已重置。";
		.@enable$ = "Heart Hunter#2dms30";
		setarray .@xy[0],183,104;
		break;
	case 30:
		.@step = 29;
		.@mes$ = "Storage 3 的安全代码已重置。";
		.@enable$ = "Heart Hunter#2dms40";
		setarray .@xy[0],120,123;
		break;
	default:
		end;
	}
	if ('nyr_daily_step != .@step)
		end;
	mes "等待安全码重置。请输入新的安全码。";
	next;
	input .@num;
	if (.@num != 'code) {
		mes "取消输入";
		close;
	}
	mes .@mes$;
	if (.@npctalk$ != "")
		npctalk .@npctalk$;
	if ('nyr_daily_step == .@step) {
		'nyr_daily_step = .@step + 1;
		enablenpc instance_npcname( .@enable$ );
	}
	navigateto("2@nyr",.@xy[0],.@xy[1]);
	close;
OnTouch:
	switch( atoi( replacestr( strnpcinfo(2), "2dms", "" ) ) ) {
	case 10:
		.@step = 19;
		break;
	case 20:
		.@step = 24;
		break;
	case 30:
		.@step = 29;
		break;
	}
	if ('nyr_daily_step <= .@step)
		npctalk "等待安全码重置";
	else
		npctalk "安全码重置完成。";
	end;
}
2@nyr,115,69,5	duplicate(Security Device#2dms10)	Security Device#2dms20	4_POINT_BLUE,5,5
2@nyr,184,100,5	duplicate(Security Device#2dms10)	Security Device#2dms30	4_POINT_BLUE,5,5

2@nyr,124,138,5	script	Security Device#2dms40	4_POINT_BLUE,5,5,{
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 33)
		end;
	mes "正在重置安全代码。请输入新的安全码。";
	next;
	input .@num;
	if (.@num != 'code) {
		mes "取消输入";
		close;
	}
	mes "保管库安全代码已重置。";
	if ('nyr_daily_step == 33) {
		'nyr_daily_step = 34;
		enablenpc instance_npcname("#2mstep10");
		enablenpc instance_npcname("#2mstep11");
		enablenpc instance_npcname("Temple Guard#2dms201");
		enablenpc instance_npcname("Temple Guard#2dms211");
		enablenpc instance_npcname("Temple Guard#2dms221");
		enablenpc instance_npcname("Temple Guard#2dms231");
		enablenpc instance_npcname("Temple Guard#2dms241");
		enablenpc instance_npcname("Temple Guard#2dms251");
		enablenpc instance_npcname("Temple Guard#2dms261");
		enablenpc instance_npcname("#msnavi01");
		mapannounce 'map_2nyr$, "Do you think we'll give up just like that? We've already tasted it. Just watch!", bc_map, 0xFFCC;
		mapannounce 'map_2nyr$, "Do you think the crowd will give up because of the delay? The taste of baboons dried up? Leave it!", bc_map, 0xFFCC;
		sleep2 1000;
		mapannounce 'map_2nyr$, "All sectors cleared! Gather at the exit!", bc_map, 0xFFCC;
	}
	navigateto("2@nyr",151,131);
	close;
OnTouch:
	if ('nyr_daily_step <= 33)
		npctalk "保管库安全代码重置正在进行中";
	else
		npctalk "保管库安全代码已重置。";
	end;
}

2@nyr,174,135,5	script	Temple Guard#2dms201	4_M_RASWORD,5,5,{
	end;
OnTouch:
	if (is_party_leader() == false)
		end;
	if ('nyr_daily_step != 34)
		end;
	'nyr_daily_step = 35;
	npctalk "感谢大家的辛勤劳动！", instance_npcname("圣殿守卫#2dms201");
	sleep 2000;
	npctalk "我们需要每天清洁圣殿一段时间！", instance_npcname("圣殿守卫#2dms201");
	sleep 2000;
	npctalk "四个！！", instance_npcname("圣殿守卫#2dms211");
	npctalk "四个！！", instance_npcname("圣殿守卫#2dms221");
	npctalk "四个！！", instance_npcname("圣殿守卫#2dms231");
	npctalk "四个！！", instance_npcname("圣殿守卫#2dms241");
	npctalk "四个！！", instance_npcname("圣殿守卫#2dms251");
	npctalk "四个！！", instance_npcname("圣殿守卫#2dms261");
	npctalk "各位，现在可以散了吧！", instance_npcname("圣殿守卫#2dms201");
	sleep 2000;
	npctalk "冒险家们，也谢谢你们的辛苦付出！直到我们再次见面！", instance_npcname("圣殿守卫#2dms201");
	end;
}

2@nyr,177,134,1	duplicate(dummy_npc)	Temple Guard#2dms211	4_M_RASWORD,3,0
2@nyr,176,133,1	duplicate(dummy_npc)	Temple Guard#2dms221	4_M_RASWORD
2@nyr,175,132,1	duplicate(dummy_npc)	Temple Guard#2dms231	4_M_RASWORD
2@nyr,178,133,1	duplicate(dummy_npc)	Temple Guard#2dms241	4_M_RASWORD
2@nyr,177,132,1	duplicate(dummy_npc)	Temple Guard#2dms251	4_M_RASWORD
2@nyr,176,131,1	duplicate(dummy_npc)	Temple Guard#2dms261	4_M_RASWORD

// 2@nyr,179,131,0	duplicate(dummy_npc)	#msnavi01	WARPNPC,3,3
2@nyr,179,131,0	script	#msnavi01	HIDDEN_WARP_NPC,3,3,{
	end;
OnTouch_:
	navigateto("2@nyr",203,220);
	end;
}
